<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>ch7</title>
      <style>html {font-size: 12px}.markdown-preview { font-family: 'Helvetica Neue', Helvetica, sans-serif; font-size: 14px; line-height: 1.6; overflow: scroll; box-sizing: border-box; padding: 20px; background-color: rgb(255, 255, 255); }
.markdown-preview code { color: rgb(51, 51, 51); }
.markdown-preview code, .markdown-preview tt, .markdown-preview pre.editor-colors { font-size: 12px; font-family: Consolas, 'Liberation Mono', Courier, monospace; }
.markdown-preview a, .markdown-preview a code { color: rgb(65, 131, 196); }
.markdown-preview ol > li { list-style-type: decimal; }
.markdown-preview ul > li { list-style-type: disc; }
.markdown-preview li > pre.editor-colors { display: inline-block; vertical-align: top; width: 100%; }
.markdown-preview li:last-child > pre.editor-colors { margin-bottom: 0px; }
.markdown-preview > :first-child { margin-top: 0px !important; }
.markdown-preview > :last-child { margin-bottom: 0px !important; }
.markdown-preview a.absent { color: rgb(204, 0, 0); }
.markdown-preview a.anchor { display: block; padding-left: 30px; margin-left: -30px; cursor: pointer; position: absolute; top: 0px; left: 0px; bottom: 0px; }
.markdown-preview h1, .markdown-preview h2, .markdown-preview h3, .markdown-preview h4, .markdown-preview h5, .markdown-preview h6 { font-family: 'Helvetica Neue', Helvetica, sans-serif; margin: 20px 0px 10px; padding: 0px 0px 10px; font-weight: bold; -webkit-font-smoothing: antialiased; cursor: text; position: relative; }
.markdown-preview h1 .octicon-link, .markdown-preview h2 .octicon-link, .markdown-preview h3 .octicon-link, .markdown-preview h4 .octicon-link, .markdown-preview h5 .octicon-link, .markdown-preview h6 .octicon-link { display: none; color: rgb(0, 0, 0); }
.markdown-preview h1:hover a.anchor, .markdown-preview h2:hover a.anchor, .markdown-preview h3:hover a.anchor, .markdown-preview h4:hover a.anchor, .markdown-preview h5:hover a.anchor, .markdown-preview h6:hover a.anchor { text-decoration: none; line-height: 1; padding-left: 0px; margin-left: -22px; top: 15%; }
.markdown-preview h1:hover a.anchor .octicon-link, .markdown-preview h2:hover a.anchor .octicon-link, .markdown-preview h3:hover a.anchor .octicon-link, .markdown-preview h4:hover a.anchor .octicon-link, .markdown-preview h5:hover a.anchor .octicon-link, .markdown-preview h6:hover a.anchor .octicon-link { display: inline-block; }
.markdown-preview h1 tt, .markdown-preview h2 tt, .markdown-preview h3 tt, .markdown-preview h4 tt, .markdown-preview h5 tt, .markdown-preview h6 tt, .markdown-preview h1 code, .markdown-preview h2 code, .markdown-preview h3 code, .markdown-preview h4 code, .markdown-preview h5 code, .markdown-preview h6 code { font-size: inherit; }
.markdown-preview h1 { font-size: 28px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); color: rgb(0, 0, 0); }
.markdown-preview h2 { font-size: 24px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(0, 0, 0); }
.markdown-preview h3 { font-size: 18px; }
.markdown-preview h4 { font-size: 16px; }
.markdown-preview h5 { font-size: 14px; }
.markdown-preview h6 { color: rgb(119, 119, 119); font-size: 14px; }
.markdown-preview p, .markdown-preview blockquote, .markdown-preview ul, .markdown-preview ol, .markdown-preview dl, .markdown-preview table, .markdown-preview pre.editor-colors { margin: 15px 0px; }
.markdown-preview hr { border: 0px none; color: rgb(204, 204, 204); height: 4px; padding: 0px; margin: 15px 0px; background: url('data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC') 0px 0px repeat-x transparent; }
.markdown-preview > h2:first-child, .markdown-preview > h1:first-child, .markdown-preview > h1:first-child + h2, .markdown-preview > h3:first-child, .markdown-preview > h4:first-child, .markdown-preview > h5:first-child, .markdown-preview > h6:first-child { margin-top: 0px; padding-top: 0px; }
.markdown-preview a:first-child h1, .markdown-preview a:first-child h2, .markdown-preview a:first-child h3, .markdown-preview a:first-child h4, .markdown-preview a:first-child h5, .markdown-preview a:first-child h6 { margin-top: 0px; padding-top: 0px; }
.markdown-preview h1 + p, .markdown-preview h2 + p, .markdown-preview h3 + p, .markdown-preview h4 + p, .markdown-preview h5 + p, .markdown-preview h6 + p { margin-top: 0px; }
.markdown-preview li p.first { display: inline-block; }
.markdown-preview ul, .markdown-preview ol { padding-left: 30px; }
.markdown-preview ul.no-list, .markdown-preview ol.no-list { list-style-type: none; padding: 0px; }
.markdown-preview ul li > :first-child, .markdown-preview ol li > :first-child, .markdown-preview ul li ul:first-of-type, .markdown-preview ol li ul:first-of-type { margin-top: 0px; }
.markdown-preview ul ul, .markdown-preview ul ol, .markdown-preview ol ol, .markdown-preview ol ul { margin-bottom: 0px; }
.markdown-preview dl { padding: 0px; }
.markdown-preview dl dt { font-size: 14px; font-weight: bold; font-style: italic; padding: 0px; margin: 15px 0px 5px; }
.markdown-preview dl dt:first-child { padding: 0px; }
.markdown-preview dl dt > :first-child { margin-top: 0px; }
.markdown-preview dl dt > :last-child { margin-bottom: 0px; }
.markdown-preview dl dd { margin: 0px 0px 15px; padding: 0px 15px; }
.markdown-preview dl dd > :first-child { margin-top: 0px; }
.markdown-preview dl dd > :last-child { margin-bottom: 0px; }
.markdown-preview blockquote { border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
.markdown-preview blockquote > :first-child { margin-top: 0px; }
.markdown-preview blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview blockquote p { font-size: 16px; line-height: 1.5; }
.markdown-preview table th { font-weight: bold; }
.markdown-preview table th, .markdown-preview table td { border: 1px solid rgb(204, 204, 204); padding: 6px 13px; }
.markdown-preview table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview img { max-width: 100%; }
.markdown-preview span.frame { display: block; overflow: hidden; }
.markdown-preview span.frame > span { border: 1px solid rgb(221, 221, 221); display: block; float: left; overflow: hidden; margin: 13px 0px 0px; padding: 7px; width: auto; }
.markdown-preview span.frame span img { display: block; float: left; }
.markdown-preview span.frame span span { clear: both; color: rgb(51, 51, 51); display: block; padding: 5px 0px 0px; }
.markdown-preview span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview span.align-center > span { display: block; overflow: hidden; margin: 13px auto 0px; text-align: center; }
.markdown-preview span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview span.align-right > span { display: block; overflow: hidden; margin: 13px 0px 0px; text-align: right; }
.markdown-preview span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview span.float-left { display: block; margin-right: 13px; overflow: hidden; float: left; }
.markdown-preview span.float-left span { margin: 13px 0px 0px; }
.markdown-preview span.float-right { display: block; margin-left: 13px; overflow: hidden; float: right; }
.markdown-preview span.float-right > span { display: block; overflow: hidden; margin: 13px auto 0px; text-align: right; }
.markdown-preview code, .markdown-preview tt { margin: 0px 2px; padding: 0px 5px; border: 1px solid rgb(234, 234, 234); border-radius: 3px; text-shadow: none; background-color: rgb(248, 248, 248); }
.markdown-preview pre.editor-colors { font-size: 13px; line-height: 19px; overflow: auto; padding: 6px 10px; border-radius: 3px; border: 1px solid rgb(224, 224, 225); background: rgb(250, 250, 250); }
.markdown-preview kbd { border-radius: 2px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221) rgb(204, 204, 204) rgb(204, 204, 204) rgb(221, 221, 221); padding: 1px 4px; line-height: 10px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-image: linear-gradient(rgb(241, 241, 241), rgb(221, 221, 221)); background-color: rgb(221, 221, 221); background-repeat: repeat-x; }
.markdown-preview .emoji { height: 20px; width: 20px; }
.markdown-preview { font-size: 1.25em; color: rgb(80, 81, 83); background-color: rgb(255, 255, 255); }
.markdown-preview h1, .markdown-preview h2 { color: inherit; border-color: rgb(218, 219, 220); }
.markdown-preview a { color: rgb(20, 146, 255); }
.markdown-preview hr { background-color: rgb(255, 255, 255); }
.markdown-preview blockquote { color: rgb(80, 81, 83); border-left-color: rgba(80, 81, 83, 0.701961); }
.markdown-preview table th, .markdown-preview table td { border-color: rgb(218, 219, 220); }
.markdown-preview table th { background-color: rgb(255, 255, 255); }
.markdown-preview table tr { background-color: rgb(255, 255, 255); }
.markdown-preview table tr:nth-child(2n) { background-color: rgb(247, 247, 247); }
.markdown-preview code { color: rgb(104, 106, 110); border-color: rgb(218, 219, 220); background-color: rgb(247, 247, 247); background-clip: padding-box; }
.markdown-preview pre.editor-colors::shadow .line.cursor-line { background-color: transparent; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}

.spell-check-misspelling .region {
  border-bottom: 1px dashed rgba(250, 128, 114, 0.5);
}

pre.editor-colors,
.host {
  background-color: #fafafa;
  color: #545454;
}
pre.editor-colors .line.cursor-line,
.host .line.cursor-line {
  background-color: rgba(56, 75, 112, 0.07);
}
pre.editor-colors .invisible,
.host .invisible {
  color: #545454;
}
pre.editor-colors .cursor,
.host .cursor {
  border-left: 2px solid #528bff;
}
pre.editor-colors .selection .region,
.host .selection .region {
  background-color: #e5e5e6;
}
pre.editor-colors .bracket-matcher .region,
.host .bracket-matcher .region {
  border-bottom: 1px solid #528bff;
  box-sizing: border-box;
  background-color: #eaeaeb;
}
pre.editor-colors .invisible-character,
.host .invisible-character {
  color: rgba(84, 84, 84, 0.4);
}
pre.editor-colors .indent-guide,
.host .indent-guide {
  color: rgba(84, 84, 84, 0.4);
}
pre.editor-colors .wrap-guide,
.host .wrap-guide {
  background-color: rgba(84, 84, 84, 0.4);
}
pre.editor-colors .gutter .line-number,
.host .gutter .line-number {
  color: #969696;
  -webkit-font-smoothing: antialiased;
}
pre.editor-colors .gutter .line-number.git-line-removed:before,
.host .gutter .line-number.git-line-removed:before {
  bottom: -3px;
}
pre.editor-colors .gutter .line-number.git-line-removed:after,
.host .gutter .line-number.git-line-removed:after {
  content: "";
  position: absolute;
  left: 0px;
  bottom: 0px;
  width: 25px;
  border-bottom: 1px dotted rgba(255, 20, 20, 0.5);
  pointer-events: none;
}
pre.editor-colors .gutter .line-number.cursor-line,
.host .gutter .line-number.cursor-line {
  color: #545454;
  background-color: #efeff0;
}
pre.editor-colors .gutter .line-number.cursor-line-no-selection,
.host .gutter .line-number.cursor-line-no-selection {
  background-color: transparent;
}
pre.editor-colors .gutter .line-number .icon-right,
.host .gutter .line-number .icon-right {
  color: #545454;
}
pre.editor-colors .gutter .line-number .icon-right,
.host .gutter .line-number .icon-right {
  color: #545454;
}
pre.editor-colors .gutter .line-number.folded,
.host .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
.host .gutter .line-number:after,
pre.editor-colors .fold-marker:after,
.host .fold-marker:after {
  color: #545454;
}
.comment {
  color: #7b7b79;
  font-style: italic;
}
.entity.name.type {
  color: #a58a03;
}
.entity.other.inherited-class {
  color: #428b1c;
}
.keyword {
  color: #a71cce;
}
.keyword.control {
  color: #a71cce;
}
.keyword.operator {
  color: #545454;
}
.keyword.other.special-method {
  color: #1f51eb;
}
.keyword.other.unit {
  color: #893a01;
}
.storage {
  color: #a71cce;
}
.constant {
  color: #893a01;
}
.constant.character.escape {
  color: #0a8560;
}
.constant.numeric {
  color: #893a01;
}
.constant.other.color {
  color: #0a8560;
}
.constant.other.symbol {
  color: #0a8560;
}
.variable {
  color: #bf1212;
}
.variable.interpolation {
  color: #b81332;
}
.variable.parameter.function {
  color: #545454;
}
.invalid.illegal {
  background-color: #bf1212;
  color: #fafafa;
}
.string {
  color: #428b1c;
}
.string.regexp {
  color: #0a8560;
}
.string.other.link {
  color: #bf1212;
}
.punctuation.definition.comment {
  color: #7b7b79;
}
.punctuation.definition.parameters,
.punctuation.definition.array {
  color: #545454;
}
.punctuation.definition.heading,
.punctuation.definition.identity {
  color: #1f51eb;
}
.punctuation.definition.bold {
  color: #a58a03;
  font-weight: bold;
}
.punctuation.definition.italic {
  color: #a71cce;
  font-style: italic;
}
.punctuation.section.embedded {
  color: #b81332;
}
.support.class {
  color: #a58a03;
}
.support.function {
  color: #0a8560;
}
.support.function.any-method {
  color: #1f51eb;
}
.entity.name.function {
  color: #1f51eb;
}
.entity.name.class,
.entity.name.type.class {
  color: #a58a03;
}
.entity.name.section {
  color: #1f51eb;
}
.entity.name.tag {
  color: #bf1212;
}
.entity.other.attribute-name {
  color: #893a01;
}
.entity.other.attribute-name.id {
  color: #1f51eb;
}
.meta.class {
  color: #a58a03;
}
.meta.link {
  color: #893a01;
}
.meta.require {
  color: #1f51eb;
}
.meta.selector {
  color: #a71cce;
}
.meta.separator {
  background-color: #373b41;
  color: #545454;
}
.meta.tag {
  color: #545454;
}
.none {
  color: #545454;
}
.markup.bold {
  color: #893a01;
  font-weight: bold;
}
.markup.changed {
  color: #a71cce;
}
.markup.deleted {
  color: #bf1212;
}
.markup.italic {
  color: #a71cce;
  font-style: italic;
}
.markup.heading .punctuation.definition.heading {
  color: #1f51eb;
}
.markup.inserted {
  color: #428b1c;
}
.markup.list {
  color: #bf1212;
}
.markup.quote {
  color: #893a01;
}
.markup.raw.inline {
  color: #428b1c;
}
.source.gfm .markup {
  -webkit-font-smoothing: auto;
}
.source.gfm .markup.heading {
  color: #bf1212;
}
.source.gfm .markup.link {
  color: #1f51eb;
}
.source.gfm .link .entity {
  color: #0a8560;
}
.ruby.symbol > .punctuation {
  color: inherit;
}
</style>
  </head>
  <body class='markdown-preview'><h1 id="7-json-rpc-server">7. JSON-RPC Server</h1>
<p>We are going to be working on the repository that you have created up to this point. If you skipped
ahead, don&#39;t worry. You can clone the repository from its Github repository.</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;git&nbsp;clone&nbsp;git@github.com:skafandri/symfony-tutorial.git&nbsp;--branch&nbsp;ch6</span></span></div><div class="line"><span class="source shell"><span>Cloning&nbsp;into&nbsp;</span><span class="string quoted single shell"><span class="punctuation definition string begin shell"><span>&#39;</span></span><span>symfony-tutorial</span><span class="punctuation definition string end shell"><span>&#39;</span></span></span><span>...</span></span></div><div class="line"><span class="source shell"><span>remote:&nbsp;Counting&nbsp;objects:&nbsp;737,&nbsp;</span><span class="keyword control shell"><span>done</span></span><span>.</span></span></div><div class="line"><span class="source shell"><span>remote:&nbsp;Total&nbsp;737&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>delta&nbsp;0</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>,&nbsp;reused&nbsp;0&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>delta&nbsp;0</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>,&nbsp;pack-reused&nbsp;737</span></span></div><div class="line"><span class="source shell"><span>Receiving&nbsp;objects:&nbsp;100%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>737/737</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>,&nbsp;418.24&nbsp;KiB&nbsp;</span><span class="keyword operator pipe shell"><span>|</span></span><span>&nbsp;66.00&nbsp;KiB/s,&nbsp;</span><span class="keyword control shell"><span>done</span></span><span>.</span></span></div><div class="line"><span class="source shell"><span>Resolving&nbsp;deltas:&nbsp;100%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>378/378</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>,&nbsp;</span><span class="keyword control shell"><span>done</span></span><span>.</span></span></div><div class="line"><span class="source shell"><span>Checking&nbsp;connectivity...&nbsp;</span><span class="keyword control shell"><span>done</span></span><span>.</span></span></div></pre>
<p>We are going to implement a JSON-RPC server to expose some of our application&#39;s logic as webservices.<br>This functionality is clearly not specific to our application.<br>For this reason, we will implement it as a stand alone bundle.</p>
<p><br></p>
<h2 id="7-1-jsonrpcbundle">7.1 JsonRpcBundle</h2>
<p>We will start to partially implement JSON-RPC 2.0 specifications. For a full specification reference please check <a href="http://www.jsonrpc.org/specification">http://www.jsonrpc.org/specification</a></p>
<p><br>
Let&#39;s start by creating a new JsonRpcBundle</p>
<ul>
<li>Create <strong>src/JsonRpcBundle/JsonRpcBundle.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>HttpKernel</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bundle</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>JsonRpcBundle</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>Bundle</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>To enable the new bundle, edit <strong>app/AppKernel.php</strong> and add <code>new JsonRpcBundle\JsonRpcBundle()</code> to the $bundles array.</p>
<p><br><br></p>
<ul>
<li>Create <strong>src/JsonRpcBundle/Server.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ContainerAware</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OptionsResolver</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OptionsResolver</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Serializer</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Encoder</span><span class="punctuation separator inheritance php"><span>\</span></span><span>JsonEncoder</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Serializer</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Exception</span><span class="punctuation separator inheritance php"><span>\</span></span><span>UnexpectedValueException</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>Server</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>ContainerAware</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ID</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>json_rpc.server</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>handle</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serviceId</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>encoder</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>JsonEncoder</span></span><span>()</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control exception php"><span>try</span></span><span>&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>encoder</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>decode</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span>,</span><span>&nbsp;</span><span class="support class php"><span>JsonEncoder</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>FORMAT</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span><span>&nbsp;</span><span class="meta catch php"><span class="keyword control exception catch php"><span>catch</span></span><span>&nbsp;(</span><span class="support class exception php"><span>UnexpectedValueException</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>exception</span></span><span>)</span></span><span>&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>ErrorResponse</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>ErrorResponse</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>ERROR_CODE_PARSE_ERROR</span></span><span>,&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>Invalid&nbsp;JSON</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>resolveOptions</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>if</span></span><span>&nbsp;(</span><span class="keyword operator logical php"><span>!</span></span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>isAllowed</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serviceId</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>method</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span><span>))&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>ErrorResponse</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>ErrorResponse</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>ERROR_CODE_METHOD_NOT_FOUND</span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support function string php"><span>sprintf</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>%s&nbsp;does&nbsp;not&nbsp;exist</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>method</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>service</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>container</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>get</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serviceId</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="support function funchand php"><span>call_user_func_array</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta array php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>service</span></span><span>,</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta array php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>method</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta array php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition array end php"><span>)</span></span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>params</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>SuccessResponse</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>id</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>isAllowed</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serviceId</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>method</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="constant language php"><span>true</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>resolveOptions</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resolver</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OptionsResolver</span></span><span>()</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resolver</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setRequired</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>id</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setRequired</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>method</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setRequired</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>jsonrpc</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setDefault</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>params</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="meta array empty php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="punctuation definition array end php"><span>)</span></span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addAllowedValues</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>jsonrpc</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,</span><span>&nbsp;</span><span class="support class php"><span>Response</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>VERSION</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resolver</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>resolve</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br></p>
<ul>
<li>Create <strong>src/JsonRpcBundle/Resources/config/services.yml</strong></li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>services:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>json_rpc.server:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;JsonRpcBundle\Server</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calls:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;[setContainer,&nbsp;[&quot;@service_container&quot;]]</span></span></span></div></pre><p><br></p>
<ul>
<li>Create <strong>src/JsonRpcBundle/DependencyInjection/JsonRpcExtension.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Config</span><span class="punctuation separator inheritance php"><span>\</span></span><span>FileLocator</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ContainerBuilder</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Extension</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Extension</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Loader</span><span class="punctuation separator inheritance php"><span>\</span></span><span>YamlFileLoader</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>JsonRpcExtension</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>Extension</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>load</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument array php"><span class="storage type php"><span>array</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>config</span></span></span><span>,&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>ContainerBuilder</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>loader</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>YamlFileLoader</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>FileLocator</span></span><span>(</span><span class="constant language php"><span>__DIR__</span></span><span class="keyword operator string php"><span>.</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>/../Resources/config</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>loader</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>load</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>services.yml</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br><br></p>
<ul>
<li>Create <strong>src/JsonRpcBundle/Response.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage modifier abstract php"><span>abstract</span></span><span>&nbsp;</span><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>Response</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>VERSION</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>2.0</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>jsonrpc</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="storage type php"><span>self</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>VERSION</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resultKey</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resultKey</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>id</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>resultKey</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resultKey</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>result</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getId</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>id</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getJsonrpc</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>jsonrpc</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getResultKey</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>resultKey</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getResult</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>result</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setId</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>id</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setJsonrpc</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>jsonrpc</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>jsonrpc</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>jsonrpc</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setResultKey</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resultKey</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>resultKey</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resultKey</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setResult</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>result</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>toArray</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta array php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>id</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span class="punctuation definition array end php"><span>)</span></span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>jsonrpc</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getJsonrpc</span></span><span>(</span><span>),</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getResultKey</span></span><span>(</span><span>)&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getResult</span></span><span>(</span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br></p>
<ul>
<li>Create <strong>src/JsonRpcBundle/SuccessResponse.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>SuccessResponse</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>Response</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type php"><span>parent</span></span><span class="keyword operator class php"><span>::</span></span><span class="meta function-call static php"><span>__construct</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span>,&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>result</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br><br><br><br><br><br><br><br></p>
<ul>
<li>Create <strong>src/JsonRpcBundle/ErrorResponse.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>ErrorResponse</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>Response</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ERROR_CODE_PARSE_ERROR</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword operator arithmetic php"><span>-</span></span><span class="constant numeric php"><span>32700</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ERROR_CODE_METHOD_NOT_FOUND</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword operator arithmetic php"><span>-</span></span><span class="constant numeric php"><span>32601</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ERROR_CODE_SERVER_ERROR</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword operator arithmetic php"><span>-</span></span><span class="constant numeric php"><span>32000</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>code</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span></span><span>,</span><span class="meta function argument default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="constant language php"><span>null</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type php"><span>parent</span></span><span class="keyword operator class php"><span>::</span></span><span class="meta function-call static php"><span>__construct</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>error</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>code</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>code</span></span><span>,&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>message</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span><span class="punctuation definition array end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br></p>
<ul>
<li>Create <strong>src/JsonRpcBundle/Exception/JsonRpcException.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Exception</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>JsonRpcException</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="support class builtin php"><span class="punctuation separator inheritance php"><span>\</span></span><span>Exception</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br></p>
<ul>
<li>Create <strong>src/JsonRpcBundle/Exception/InvalidMethodException.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Exception</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>InvalidMethodException</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>JsonRpcException</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br><br><br></p>
<ul>
<li>Create <strong>src/JsonRpcBundle/Controller/ServerController.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Controller</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Server</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>FrameworkBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Controller</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Controller</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>HttpFoundation</span><span class="punctuation separator inheritance php"><span>\</span></span><span>JsonResponse</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>HttpFoundation</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Request</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>ServerController</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>Controller</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>handleAction</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Request</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>service</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>server</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>get</span></span><span>(</span><span class="support class php"><span>Server</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>ID</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>server</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>handle</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getContent</span></span><span>(</span><span>),&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>service</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>JsonResponse</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>toArray</span></span><span>(</span><span>))</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<ul>
<li>Create <strong>src/JsonRpcBundle/Resources/config/routing.yml</strong></li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>json_rpc:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>path:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/json-rpc/{service}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;defaults:&nbsp;{&nbsp;_controller:&nbsp;&quot;JsonRpcBundle:Server:handle&quot;&nbsp;}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;methods:&nbsp;[POST]</span></span></span></div></pre><ul>
<li>Edit <strong>app/config/routing.yml</strong> and add the fowlling route</li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>json_rpc:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>resource:&nbsp;&quot;@JsonRpcBundle/Resources/config/routing.yml&quot;</span></span></span></div></pre><ul>
<li>Edit <strong>src/AppBundle/Service/WarehouseService.php</strong> update getAll method</li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span>public&nbsp;function&nbsp;getAll()</span></span></div><div class="line"><span class="text html php"><span>{</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;entityManager</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;createQueryBuilder()</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;select(&#39;warehouse&#39;)</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;from(Warehouse::REPOSITORY,&nbsp;&#39;warehouse&#39;)</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;getQuery()</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;getArrayResult();</span></span></div><div class="line"><span class="text html php"><span>}</span></span></div></pre>
<p><br><br><br></p>
<p>Done, you can check if this webservice is working by posting</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&quot;jsonrpc&quot;:&nbsp;&quot;2.0&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&quot;method&quot;:&nbsp;&quot;getAll&quot;,&nbsp;&nbsp;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&quot;id&quot;:&nbsp;1</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><p>to <a href="http://127.0.0.1:8000/json-rpc/app.warehouse">http://127.0.0.1:8000/json-rpc/app.warehouse</a></p>
<p>You should get a response similar to</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&quot;id&quot;:&nbsp;1,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&quot;jsonrpc&quot;:&nbsp;&quot;2.0&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&quot;result&quot;:&nbsp;[</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&quot;id&quot;:&nbsp;1,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;name&quot;:&nbsp;&quot;warehouse&nbsp;1&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;address&quot;:&nbsp;null</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>},</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&quot;id&quot;:&nbsp;2,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;name&quot;:&nbsp;&quot;warehouse&nbsp;2&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;address&quot;:&nbsp;null</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><p><br></p>
<h2 id="7-2-service-tagging">7.2 Service tagging</h2>
<p>The bundle we just created will expose any method from any service available in our application.</p>
<p>If you try for example to post</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&quot;jsonrpc&quot;:&nbsp;&quot;2.0&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&quot;method&quot;:&nbsp;&quot;trans&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&quot;params&quot;:&nbsp;[&quot;order.status.20&quot;],</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&quot;id&quot;:&nbsp;1</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><p>to <a href="http://127.0.0.1:8000/json-rpc/translator">http://127.0.0.1:8000/json-rpc/translator</a> you will get</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&quot;id&quot;:&nbsp;1,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&quot;jsonrpc&quot;:&nbsp;&quot;2.0&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&quot;result&quot;:&nbsp;&quot;delivered&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><p>Which is not ok. We have to update the method/service filtering that we have it now hard coded to allow everything.</p>
<p>The <code>isAllowed</code> method from our server service just returns true. We will update this logic to effectively check if the method is allowed.</p>
<ul>
<li>Edit <strong>src/JsonRpcBundle/Server.php</strong></li>
</ul>
<p>Add  private $allowedMethods = array();</p>
<p>Update isAllowed method</p>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span>private&nbsp;function&nbsp;isAllowed($serviceId,&nbsp;$method)</span></span></div><div class="line"><span class="text html php"><span>{</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;in_array(sprintf(&#39;%s-&gt;%s&#39;,&nbsp;$serviceId,&nbsp;$method),&nbsp;$this-&gt;allowedMethods);</span></span></div><div class="line"><span class="text html php"><span>}</span></span></div></pre>
<p>Add addAllowedMethod</p>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span>public&nbsp;function&nbsp;addAllowedMethod($serviceId,&nbsp;$method)</span></span></div><div class="line"><span class="text html php"><span>{</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;allowedMethods[]&nbsp;=&nbsp;sprintf(&#39;%s-&gt;%s&#39;,&nbsp;$serviceId,&nbsp;$method);</span></span></div><div class="line"><span class="text html php"><span>}</span></span></div></pre>
<p>Now we need a way to gather the list of serviceId/method.</p>
<p>We will define a custom tag [json_rpc.service] and add it to each service method we want to enable.</p>
<ul>
<li>Edit <strong>src/AppBundle/Resources/config/services.yml</strong> and update app.warehouse definition</li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>app.warehouse:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\WarehouseService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent:&nbsp;app.doctrine_aware</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;json_rpc.service,&nbsp;method:&nbsp;getAll}</span></span></span></div></pre><p>To parse all the services tagged with our custom tag, we will need to write a custom compiler pass.</p>
<ul>
<li>Create <strong>src/JsonRpcBundle/DependencyInjection/Compiler/ServicePass.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Compiler</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Compiler</span><span class="punctuation separator inheritance php"><span>\</span></span><span>CompilerPassInterface</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ContainerBuilder</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>ServicePass</span></span><span>&nbsp;</span><span class="storage modifier implements php"><span>implements</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>CompilerPassInterface</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>process</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>ContainerBuilder</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serverDefinition</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>findDefinition</span></span><span>(</span><span class="support other namespace php"><span class="punctuation separator inheritance php"><span>\</span></span><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span></span><span class="support class php"><span>Server</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>ID</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resolvers</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>findTaggedServiceIds</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>json_rpc.service</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>foreach</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resolvers</span></span><span>&nbsp;</span><span class="keyword operator logical php"><span>as</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>tagAttributes</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>foreach</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>tagAttributes</span></span><span>&nbsp;</span><span class="keyword operator logical php"><span>as</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>attributes</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>method</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>attributes</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>method</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serverDefinition</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addMethodCall</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>addAllowedMethod</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>method</span></span><span class="punctuation definition array end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>Now we need to add the previous compiler pass when building our bundle.</p>
<ul>
<li>Edit <strong>src/JsonRpcBundle/JsonRpcBundle.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Compiler</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ServicePass</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ContainerBuilder</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>HttpKernel</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bundle</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>JsonRpcBundle</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>Bundle</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>build</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>ContainerBuilder</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type php"><span>parent</span></span><span class="keyword operator class php"><span>::</span></span><span class="meta function-call static php"><span>build</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addCompilerPass</span></span><span>(</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>ServicePass</span></span><span>())</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>Done, clear your cache, now only app.warehouse-&gt;getAll is accessible as a json-rpc service.</p>
<p>When our application will grow and we will have many services exposed as json-rpc services, we can inspect the methods list by running</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;app/console&nbsp;debug:container&nbsp;--tag=json_rpc.service</span></span></div><div class="line"><span class="source shell"><span>[container]&nbsp;Public&nbsp;services&nbsp;with&nbsp;tag&nbsp;json_rpc.service</span></span></div><div class="line"><span class="source shell"><span>Service&nbsp;ID&nbsp;&nbsp;&nbsp;&nbsp;method&nbsp;Class&nbsp;name</span></span></div><div class="line"><span class="source shell"><span>app.warehouse&nbsp;getAll&nbsp;AppBundle</span><span class="constant character escape shell"><span>\S</span></span><span>ervice</span><span class="constant character escape shell"><span>\W</span></span><span>arehouseService</span></span></div></pre>
<h2 id="7-3-order-service">7.3 Order service</h2>
<p>We will create an Order service with only one method for the moment <code>createOrder</code>.</p>
<p>When creating an order, we want to do the following:</p>
<ul>
<li>Reserve the order products in warehouses</li>
<li>Send a &#39;thank you&#39; email to the customer (we will implement this later)</li>
<li>Log informations about the order creation</li>
</ul>
<p>An obvious function schema may look like this</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>function&nbsp;createOrder(){``</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>logOrderCreate();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;saveToDatabase();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;reserveProductsInWarehosue();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;sendThankYouEmail();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;logOrderCreateFinished();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><p>This method may have several problems:</p>
<ul>
<li>It break the SRP (Single Responsibility Principle) createOrder is doing many things besides creating an order.</li>
<li>It breaks the Open/closed principle. If we want to change the way we log the order creation for example, we will have to change the createOrder method.</li>
<li>The order service will need to be coupled with many services (warehouse service, communication service, logging service...)</li>
</ul>
<p>We will rather implement the createOrder as following</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>function&nbsp;createOrder(){</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>dispatchEvent(creating&nbsp;order);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;saveToDatabase();</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;dispatchEvent(order&nbsp;created);</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><p>This way, the order creation logic doesn&#39;t know anything about logging or customer communication logic.
And we can add/remove/change event subscribers without touching the order creation logic.<br>Since event dispatching will be used in many services, we will add this functionality to our parent service.</p>
<ul>
<li>Edit <strong>src/AppBundle/Service/AbstractDoctrineAware.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Doctrine</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DoctrineBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Registry</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Doctrine</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ORM</span><span class="punctuation separator inheritance php"><span>\</span></span><span>EntityManager</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bridge</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Monolog</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Logger</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>HttpKernel</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Debug</span><span class="punctuation separator inheritance php"><span>\</span></span><span>TraceableEventDispatcher</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>AbstractDoctrineAware</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ID</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>app.doctrine_aware</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="keyword other phpdoc php"><span>@var</span></span><span>&nbsp;Registry</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>protected</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>doctrine</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="keyword other phpdoc php"><span>@var</span></span><span>&nbsp;EntityManager</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>protected</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>entityManager</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="keyword other phpdoc php"><span>@var</span></span><span>&nbsp;Logger</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>protected</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="keyword other phpdoc php"><span>@var</span></span><span>&nbsp;TraceableEventDispatcher</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>protected</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>eventDispatcher</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>Registry</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>doctrine</span></span></span><span>,</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>Logger</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span></span><span>,</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>TraceableEventDispatcher</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>eventDispatcher</span></span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span class="meta function argument typehinted php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>doctrine</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>doctrine</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>doctrine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getManager</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>logger</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>eventDispatcher</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<ul>
<li>Create <strong>src/AppBundle/Service/OrderService.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Customer</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderProductLine</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ProductSale</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderAfterCreate</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderBeforeCreate</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderEvent</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderService</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>AbstractDoctrineAware</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ID</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>app.order</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>createOrder</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>BEFORE_CREATE</span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderBeforeCreate</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>Order</span></span><span>()</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setCustomer</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>doctrine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getRepository</span></span><span>(</span><span class="support class php"><span>Customer</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>REPOSITORY</span></span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>find</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>foreach</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span><span>&nbsp;</span><span class="keyword operator logical php"><span>as</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>product</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>createProductLine</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>product</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>id</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>product</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>quantity</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>persist</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>flush</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>AFTER_CREATE</span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderAfterCreate</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>createProductLine</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productSaleId</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>quantity</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderProductLine</span></span><span>()</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setProductSale</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>doctrine</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getRepository</span></span><span>(</span><span class="support class php"><span>ProductSale</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>REPOSITORY</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>find</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productSaleId</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setQuantity</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>quantity</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setOrder</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addProductLine</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>persist</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<ul>
<li>Create <strong>src/AppBundle/Event/Order/OrderEvent.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>EventDispatcher</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>Event</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>BEFORE_CREATE</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.before_create</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>AFTER_CREATE</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.after_create</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>PRODUCTS_RESERVED</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.products_reserver</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br></p>
<ul>
<li>Create <strong>src/AppBundle/Event/Order/OrderBeforeCreate.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderBeforeCreate</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>OrderEvent</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>customerId</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>products</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getCustomerId</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>customerId</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getProducts</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>products</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br><br><br><br></p>
<ul>
<li>Create <strong>src/AppBundle/Event/Order/OrderAfterCreate.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderAfterCreate</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>OrderEvent</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="keyword other phpdoc php"><span>@var</span></span><span>&nbsp;Order</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>order</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getOrder</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>order</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<ul>
<li>Edit <strong>src/AppBundle/Resources/config/services.yml</strong></li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>imports:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{&nbsp;resource:&nbsp;listeners.yml&nbsp;}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;{&nbsp;resource:&nbsp;events.xml&nbsp;}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>services:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.doctrine_aware:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\AbstractDoctrineAware</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arguments:&nbsp;[@doctrine,&nbsp;@logger,&nbsp;@event_dispatcher]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abstract:&nbsp;true</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.warehouse:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\WarehouseService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent:&nbsp;app.doctrine_aware</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;json_rpc.service,&nbsp;method:&nbsp;getAll}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.catalog:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\CatalogService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent:&nbsp;app.doctrine_aware</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.order:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\OrderService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent:&nbsp;app.doctrine_aware</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;json_rpc.service,&nbsp;method:&nbsp;createOrder}</span></span></span></div></pre><ul>
<li>Create <strong>src/AppBundle/Resources/config/listeners.yml</strong></li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>services:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.listener.soft_delete:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Event\Listener\SoftDelete</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{&nbsp;name:&nbsp;doctrine.event_listener,&nbsp;event:&nbsp;onFlush&nbsp;}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.order_listener:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Event\Listener\OrderListener</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent:&nbsp;app.doctrine_aware</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calls:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;[setWarehouseService,&nbsp;[&quot;@app.warehouse&quot;]]</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>tags:&nbsp;#each&nbsp;tag&nbsp;should&nbsp;be&nbsp;on&nbsp;a&nbsp;single&nbsp;line,&nbsp;I&nbsp;split&nbsp;it&nbsp;here&nbsp;for&nbsp;readability</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>event:%app.order_before_create%,method:onBeforeCreate}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>event:&nbsp;%app.order_after_create%,method:onAfterCreate}</span></span></span></div></pre><p><br></p>
<ul>
<li>Create <strong>src/AppBundle/Resources/config/events.xml</strong></li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;&nbsp;?&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;container&nbsp;xmlns=&quot;</span><span class="markup underline link http hyperlink"><span>http://symfony.com/schema/dic/services</span></span><span>&quot;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>xmlns:xsi=&quot;</span><span class="markup underline link http hyperlink"><span>http://www.w3.org/2001/XMLSchema-instance</span></span><span>&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xsi:schemaLocation=&quot;</span><span class="markup underline link http hyperlink"><span>http://symfony.com/schema/dic/services</span></span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span class="markup underline link http hyperlink"><span>http://symfony.com/schema/dic/services/services-1.0.xsd</span></span><span>&quot;&gt;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&lt;parameters&gt;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&lt;parameter&nbsp;key=&quot;app.order_before_create&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;constant&quot;&gt;AppBundle\Event\Order\OrderEvent::BEFORE_CREATE&lt;/parameter&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;parameter&nbsp;key=&quot;app.order_after_create&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;constant&quot;&gt;AppBundle\Event\Order\OrderEvent::AFTER_CREATE&lt;/parameter&gt;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&lt;/parameters&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;/container&gt;</span></span></span></div></pre><p><br><br><br><br><br><br><br><br><br><br><br><br></p>
<ul>
<li>Create <strong>src/AppBundle/Event/Listener/OrderListener.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Listener</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderAfterCreate</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderBeforeCreate</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span><span class="punctuation separator inheritance php"><span>\</span></span><span>AbstractDoctrineAware</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span><span class="punctuation separator inheritance php"><span>\</span></span><span>WarehouseService</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderListener</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>AbstractDoctrineAware</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block php"><span class="punctuation definition comment php"><span>/*</span></span><span>*&nbsp;@var&nbsp;WarehouseService&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>warehouseService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onBeforeCreate</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderBeforeCreate</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>logger</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addInfo</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>Creating&nbsp;order</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta array php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>customerId</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getCustomerId</span></span><span>(</span><span class="punctuation definition array end php"><span>)</span></span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>products</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getProducts</span></span><span>(</span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onAfterCreate</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderAfterCreate</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>logger</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addInfo</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>Order&nbsp;created</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>orderId</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span class="punctuation definition array end php"><span>)</span></span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span>))</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>warehouseService</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>reserveProducts</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>))</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setWarehouseService</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>WarehouseService</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>warehouseService</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>warehouseService</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>warehouseService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<ul>
<li>Edit <strong>src/AppBundle/Service/WarehouseService.php</strong> and add</li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span>public&nbsp;function&nbsp;reserveProducts(Order&nbsp;$order)</span></span></div><div class="line"><span class="text html php"><span>{</span></span></div><div class="line"><span class="text html php"><span>&nbsp;</span></span></div><div class="line"><span class="text html php"><span>}</span></span></div></pre>
<p>Now, if you post</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&quot;jsonrpc&quot;:&nbsp;&quot;2.0&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&quot;method&quot;:&nbsp;&quot;createOrder&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&quot;params&quot;:&nbsp;{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&quot;customerId&quot;:&nbsp;&quot;1&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&quot;products&quot;:&nbsp;[</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>{&quot;id&quot;:&nbsp;&quot;1&quot;,&nbsp;&quot;quantity&quot;:&quot;5&quot;},</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&quot;id&quot;:&nbsp;&quot;2&quot;,&nbsp;&quot;quantity&quot;:&quot;8&quot;}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>]</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>},</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&quot;id&quot;:&nbsp;1</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><p>To <a href="http://127.0.0.1:8000/json-rpc/app.order">http://127.0.0.1:8000/json-rpc/app.order</a></p>
<p>If you check <strong>app/logs/dev.log</strong> (or <strong>prod.log</strong> if you run your application in prod mode) you should see similar entries like</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>app.INFO:&nbsp;Creating&nbsp;order&nbsp;{&quot;customerId&quot;:&quot;1&quot;,&quot;products&quot;:&nbsp;\</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>[{&quot;id&quot;:&quot;1&quot;,&quot;quantity&quot;:&quot;5&quot;},{&quot;id&quot;:&quot;2&quot;,&quot;quantity&quot;:&quot;8&quot;}]}&nbsp;[]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>app.INFO:&nbsp;Order&nbsp;created&nbsp;{&quot;orderId&quot;:20}&nbsp;[]</span></span></span></div></pre><p><br></p>
<h2 id="7-4-service-aliases">7.4 Service aliases</h2>
<p>Sometimes you would like to access a service through another name.
In our case, to use the order webservice you should post to <a href="http://127.0.0.1:8000/json-rpc/app.order">http://127.0.0.1:8000/json-rpc/app.order</a><br>We would like to provider a more convinient URL to access our webservice. <a href="http://127.0.0.1:8000/json-rpc/order">http://127.0.0.1:8000/json-rpc/order</a> would look better.
We will do the same with <a href="http://127.0.0.1:8000/json-rpc/app.warehouse">http://127.0.0.1:8000/json-rpc/app.warehouse</a></p>
<p>Setting aliases is very simple.</p>
<ul>
<li>Edit <strong>src/AppBundle/Resources/config/services.yml</strong> and add</li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>order:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>alias:&nbsp;app.order</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>warehouse:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>alias:&nbsp;app.warehouse</span></span></span></div></pre><p>At the same level with <code>app.order</code></p>
<p>Now, calling <code>$container-&gt;get(&#39;app.order&#39;)</code> is equivalent to <code>$container-&gt;get(&#39;order&#39;)</code></p>
<p>We need to update our compiler pass to take in consideration aliases. We will also add a validation to make sure that the methods exposed are callables.</p>
<p><br></p>
<ul>
<li>Edit <strong>src/JsonRpcBundle/DependencyInjection/Compiler/ServicePass.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Compiler</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Server</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Compiler</span><span class="punctuation separator inheritance php"><span>\</span></span><span>CompilerPassInterface</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ContainerBuilder</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DependencyInjection</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Definition</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Exception</span><span class="punctuation separator inheritance php"><span>\</span></span><span>InvalidMethodException</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>ServicePass</span></span><span>&nbsp;</span><span class="storage modifier implements php"><span>implements</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>CompilerPassInterface</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>process</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>ContainerBuilder</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serverDefinition</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>findDefinition</span></span><span>(</span><span class="support class php"><span>Server</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>ID</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resolvers</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>findTaggedServiceIds</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>json_rpc.service</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>foreach</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>resolvers</span></span><span>&nbsp;</span><span class="keyword operator logical php"><span>as</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>tags</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>registerMethods</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serverDefinition</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>tags</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>foreach</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getAliases</span></span><span>(</span><span>)&nbsp;</span><span class="keyword operator logical php"><span>as</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>aliasName</span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>alias</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>if</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>alias</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>isPublic</span></span><span>(</span><span>)&nbsp;</span><span class="keyword operator logical php"><span>&amp;&amp;</span></span><span>&nbsp;(</span><span class="storage type php"><span>string</span></span><span>)</span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>alias</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span><span>=</span><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>registerMethods</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serverDefinition</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>aliasName</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>tags</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>registerMethods</span></span><span class="punctuation definition parameters begin php"><span>(</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>ContainerBuilder</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span></span><span>,&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>Definition</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>server</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serviceId</span></span></span><span>,&nbsp;$tags</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>class</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>container</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>findDefinition</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serviceId</span></span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getClass</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>foreach</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>tags</span></span><span>&nbsp;</span><span class="keyword operator logical php"><span>as</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>tag</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>method</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>tag</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>method</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>if</span></span><span>&nbsp;(</span><span class="keyword operator logical php"><span>!</span></span><span class="support function var php"><span>is_callable</span></span><span>(</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>class</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>method</span></span><span class="punctuation definition array end php"><span>)</span></span></span><span>))&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control exception php"><span>throw</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>InvalidMethodException</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support function string php"><span>sprintf</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>%s::%s&nbsp;is&nbsp;not&nbsp;callable</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>class</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>method</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>server</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addMethodCall</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>addAllowedMethod</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>serviceId</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>method</span></span><span class="punctuation definition array end php"><span>)</span></span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>We will update the Server to make the allowed methods data structure more explicit (now we have it as a list of concatinated <strong>serviceId-&gt;method</strong>).</p>
<p><br></p>
<ul>
<li>Edit <strong>src/JsonRpcBundle/Server.php</strong></li>
</ul>
<p>Update <code>isAllowed</code> and <code>addAllowedMethod</code> methods</p>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span>private&nbsp;function&nbsp;isAllowed($serviceId,&nbsp;$method)</span></span></div><div class="line"><span class="text html php"><span>{</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array_key_exists($serviceId,&nbsp;$this-&gt;allowedMethods)&nbsp;</span><span class="invalid illegal bad-ampersand html"><span>&amp;</span><span>&amp;</span></span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in_array($method,&nbsp;$this-&gt;allowedMethods[$serviceId]);</span></span></div><div class="line"><span class="text html php"><span>}</span></span></div><div class="line"><span class="text html php"><span>&nbsp;</span></span></div><div class="line"><span class="text html php"><span>public&nbsp;function&nbsp;addAllowedMethod($serviceId,&nbsp;$method)</span></span></div><div class="line"><span class="text html php"><span>{</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(empty($this-&gt;allowedMethods[$serviceId]))&nbsp;{</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;allowedMethods[$serviceId]&nbsp;=&nbsp;array();</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></div><div class="line"><span class="text html php"><span>&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;allowedMethods[$serviceId][]&nbsp;=&nbsp;$method;</span></span></div><div class="line"><span class="text html php"><span>}</span></span></div></pre>
<p><br></p>
<h2 id="7-5-configuration-expressions">7.5 Configuration expressions</h2>
<p>We will create an EmailService that is capable of using several external email providers to send emails.</p>
<p>As a start, we will have two email providers. PhpProvider that will use PHP&#39;s <strong>mail</strong> function, and DevProvider that will just do nothing.</p>
<p><br></p>
<ul>
<li>Create <strong>src/AppBundle/Communication/Email/Message.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Communication</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Email</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>Message</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>to</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>subject</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>additionalHeaders</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>additionalParameters</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getTo</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>to</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getSubject</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>subject</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getMessage</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>message</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getAdditionalHeaders</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>additionalHeaders</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getAdditionalParameters</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>additionalParameters</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setTo</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>to</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>to</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>to</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setSubject</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>subject</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>subject</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>subject</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setMessage</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>message</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setAdditionalHeaders</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>additionalHeaders</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>additionalHeaders</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>additionalHeaders</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setAdditionalParameters</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>additionalParameters</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>additionalParameters</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>additionalParameters</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br></p>
<ul>
<li>Create <strong>src/AppBundle/Communication/Email/ProviderInterface.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Communication</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Email</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta interface php"><span class="storage type interface php"><span>interface</span></span><span>&nbsp;</span><span class="entity name type interface php"><span>ProviderInterface</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>send</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Message</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br></p>
<ul>
<li>Create <strong>src/AppBundle/Communication/Email/PhpProvider.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Communication</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Email</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>PhpProvider</span></span><span>&nbsp;</span><span class="storage modifier implements php"><span>implements</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>ProviderInterface</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>send</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Message</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="support function mail php"><span>mail</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getTo</span></span><span>(</span><span>),</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getSubject</span></span><span>(</span><span>),</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getMessage</span></span><span>(</span><span>),</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getAdditionalHeaders</span></span><span>(</span><span>),</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getAdditionalParameters</span></span><span>(</span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br><br><br><br><br><br><br><br><br><br><br><br><br></p>
<ul>
<li>Create <strong>src/AppBundle/Communication/Email/DevProvider.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Communication</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Email</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>DevProvider</span></span><span>&nbsp;</span><span class="storage modifier implements php"><span>implements</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>ProviderInterface</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>send</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Message</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="constant language php"><span>true</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<ul>
<li>Create <strong>src/AppBundle/Service/EmailService.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Communication</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Email</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Message</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Communication</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Email</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ProviderInterface</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>EmailService</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>providers</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="meta array empty php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="punctuation definition array end php"><span>)</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>providerIndex</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword operator arithmetic php"><span>-</span></span><span class="constant numeric php"><span>1</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>addProvider</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>ProviderInterface</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>provider</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>providers</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="punctuation section array end php"><span>]</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>provider</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>send</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Message</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>incrementIndex</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>provider</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>providerIndex</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>providerIndex</span></span><span class="punctuation section array end php"><span>]</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>provider</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>send</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>message</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>incrementIndex</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>providerIndex</span></span><span class="keyword operator increment-decrement php"><span>++</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>if</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>providerIndex</span></span><span>&nbsp;</span><span class="keyword operator comparison php"><span>&gt;</span></span><span>&nbsp;</span><span class="support function array php"><span>count</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>providers</span></span><span>)&nbsp;</span><span class="keyword operator arithmetic php"><span>-</span></span><span>&nbsp;</span><span class="constant numeric php"><span>1</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>providerIndex</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="constant numeric php"><span>0</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>Now we are ready to define the desired services, however we want to add some logic to the service definition.
If the application is running in <strong>dev</strong> mode add only DevProvider, otherwise add PhpProvider</p>
<ul>
<li>Create <strong>src/AppBundle/Resources/config/email_providers.yml</strong></li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>services:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.provider_email_php:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Communication\Email\PhpProvider</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.provider_email_dev:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Communication\Email\DevProvider</span></span></span></div></pre><p><br></p>
<ul>
<li>Edit <strong>src/AppBundle/Resources/config/services.yml</strong> and add the following service definition</li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>app.email:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\EmailService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calls:&nbsp;#The&nbsp;following&nbsp;should&nbsp;be&nbsp;on&nbsp;one&nbsp;line,&nbsp;I&nbsp;split&nbsp;it&nbsp;here&nbsp;for&nbsp;readability</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;[&quot;addProvider&quot;,&nbsp;[&quot;@=service(&#39;kernel&#39;).getEnvironment()&nbsp;===&nbsp;&#39;dev&#39;&nbsp;?</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service(&#39;app.provider_email_dev&#39;)&nbsp;:&nbsp;service(&#39;app.provider_email_php&#39;)&quot;]]</span></span></span></div></pre><p><br></p>
<h2 id="7-6-homework">7.6 Homework</h2>
<ol>
<li>If a logger service is available, update the json-rpc service to log the received request and/or the response. Logging the request or the response should be switchable on/off from a configuration.<br>The logger will use a new chanel <strong>json-rpc</strong> that will write to &quot;app/log/json-rpc-{environment}.log&quot;</li>
<li>When an order is created, send the follwoing email to the customer: Thank you {client name}, your order number {orderId} is being processed.</li>
</ol></body>
</html>
