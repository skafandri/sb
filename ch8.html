<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>ch8</title>
      <style>html {font-size: 12px}.markdown-preview { font-family: 'Helvetica Neue', Helvetica, sans-serif; font-size: 14px; line-height: 1.6; overflow: scroll; box-sizing: border-box; padding: 20px; background-color: rgb(255, 255, 255); }
.markdown-preview code { color: rgb(51, 51, 51); }
.markdown-preview code, .markdown-preview tt, .markdown-preview pre.editor-colors { font-size: 12px; font-family: Consolas, 'Liberation Mono', Courier, monospace; }
.markdown-preview a, .markdown-preview a code { color: rgb(65, 131, 196); }
.markdown-preview ol > li { list-style-type: decimal; }
.markdown-preview ul > li { list-style-type: disc; }
.markdown-preview li > pre.editor-colors { display: inline-block; vertical-align: top; width: 100%; }
.markdown-preview li:last-child > pre.editor-colors { margin-bottom: 0px; }
.markdown-preview > :first-child { margin-top: 0px !important; }
.markdown-preview > :last-child { margin-bottom: 0px !important; }
.markdown-preview a.absent { color: rgb(204, 0, 0); }
.markdown-preview a.anchor { display: block; padding-left: 30px; margin-left: -30px; cursor: pointer; position: absolute; top: 0px; left: 0px; bottom: 0px; }
.markdown-preview h1, .markdown-preview h2, .markdown-preview h3, .markdown-preview h4, .markdown-preview h5, .markdown-preview h6 { font-family: 'Helvetica Neue', Helvetica, sans-serif; margin: 20px 0px 10px; padding: 0px 0px 10px; font-weight: bold; -webkit-font-smoothing: antialiased; cursor: text; position: relative; }
.markdown-preview h1 .octicon-link, .markdown-preview h2 .octicon-link, .markdown-preview h3 .octicon-link, .markdown-preview h4 .octicon-link, .markdown-preview h5 .octicon-link, .markdown-preview h6 .octicon-link { display: none; color: rgb(0, 0, 0); }
.markdown-preview h1:hover a.anchor, .markdown-preview h2:hover a.anchor, .markdown-preview h3:hover a.anchor, .markdown-preview h4:hover a.anchor, .markdown-preview h5:hover a.anchor, .markdown-preview h6:hover a.anchor { text-decoration: none; line-height: 1; padding-left: 0px; margin-left: -22px; top: 15%; }
.markdown-preview h1:hover a.anchor .octicon-link, .markdown-preview h2:hover a.anchor .octicon-link, .markdown-preview h3:hover a.anchor .octicon-link, .markdown-preview h4:hover a.anchor .octicon-link, .markdown-preview h5:hover a.anchor .octicon-link, .markdown-preview h6:hover a.anchor .octicon-link { display: inline-block; }
.markdown-preview h1 tt, .markdown-preview h2 tt, .markdown-preview h3 tt, .markdown-preview h4 tt, .markdown-preview h5 tt, .markdown-preview h6 tt, .markdown-preview h1 code, .markdown-preview h2 code, .markdown-preview h3 code, .markdown-preview h4 code, .markdown-preview h5 code, .markdown-preview h6 code { font-size: inherit; }
.markdown-preview h1 { font-size: 28px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); color: rgb(0, 0, 0); }
.markdown-preview h2 { font-size: 24px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); color: rgb(0, 0, 0); }
.markdown-preview h3 { font-size: 18px; }
.markdown-preview h4 { font-size: 16px; }
.markdown-preview h5 { font-size: 14px; }
.markdown-preview h6 { color: rgb(119, 119, 119); font-size: 14px; }
.markdown-preview p, .markdown-preview blockquote, .markdown-preview ul, .markdown-preview ol, .markdown-preview dl, .markdown-preview table, .markdown-preview pre.editor-colors { margin: 15px 0px; }
.markdown-preview hr { border: 0px none; color: rgb(204, 204, 204); height: 4px; padding: 0px; margin: 15px 0px; background: url('data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC') 0px 0px repeat-x transparent; }
.markdown-preview > h2:first-child, .markdown-preview > h1:first-child, .markdown-preview > h1:first-child + h2, .markdown-preview > h3:first-child, .markdown-preview > h4:first-child, .markdown-preview > h5:first-child, .markdown-preview > h6:first-child { margin-top: 0px; padding-top: 0px; }
.markdown-preview a:first-child h1, .markdown-preview a:first-child h2, .markdown-preview a:first-child h3, .markdown-preview a:first-child h4, .markdown-preview a:first-child h5, .markdown-preview a:first-child h6 { margin-top: 0px; padding-top: 0px; }
.markdown-preview h1 + p, .markdown-preview h2 + p, .markdown-preview h3 + p, .markdown-preview h4 + p, .markdown-preview h5 + p, .markdown-preview h6 + p { margin-top: 0px; }
.markdown-preview li p.first { display: inline-block; }
.markdown-preview ul, .markdown-preview ol { padding-left: 30px; }
.markdown-preview ul.no-list, .markdown-preview ol.no-list { list-style-type: none; padding: 0px; }
.markdown-preview ul li > :first-child, .markdown-preview ol li > :first-child, .markdown-preview ul li ul:first-of-type, .markdown-preview ol li ul:first-of-type { margin-top: 0px; }
.markdown-preview ul ul, .markdown-preview ul ol, .markdown-preview ol ol, .markdown-preview ol ul { margin-bottom: 0px; }
.markdown-preview dl { padding: 0px; }
.markdown-preview dl dt { font-size: 14px; font-weight: bold; font-style: italic; padding: 0px; margin: 15px 0px 5px; }
.markdown-preview dl dt:first-child { padding: 0px; }
.markdown-preview dl dt > :first-child { margin-top: 0px; }
.markdown-preview dl dt > :last-child { margin-bottom: 0px; }
.markdown-preview dl dd { margin: 0px 0px 15px; padding: 0px 15px; }
.markdown-preview dl dd > :first-child { margin-top: 0px; }
.markdown-preview dl dd > :last-child { margin-bottom: 0px; }
.markdown-preview blockquote { border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
.markdown-preview blockquote > :first-child { margin-top: 0px; }
.markdown-preview blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview blockquote p { font-size: 16px; line-height: 1.5; }
.markdown-preview table th { font-weight: bold; }
.markdown-preview table th, .markdown-preview table td { border: 1px solid rgb(204, 204, 204); padding: 6px 13px; }
.markdown-preview table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview img { max-width: 100%; }
.markdown-preview span.frame { display: block; overflow: hidden; }
.markdown-preview span.frame > span { border: 1px solid rgb(221, 221, 221); display: block; float: left; overflow: hidden; margin: 13px 0px 0px; padding: 7px; width: auto; }
.markdown-preview span.frame span img { display: block; float: left; }
.markdown-preview span.frame span span { clear: both; color: rgb(51, 51, 51); display: block; padding: 5px 0px 0px; }
.markdown-preview span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview span.align-center > span { display: block; overflow: hidden; margin: 13px auto 0px; text-align: center; }
.markdown-preview span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview span.align-right > span { display: block; overflow: hidden; margin: 13px 0px 0px; text-align: right; }
.markdown-preview span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview span.float-left { display: block; margin-right: 13px; overflow: hidden; float: left; }
.markdown-preview span.float-left span { margin: 13px 0px 0px; }
.markdown-preview span.float-right { display: block; margin-left: 13px; overflow: hidden; float: right; }
.markdown-preview span.float-right > span { display: block; overflow: hidden; margin: 13px auto 0px; text-align: right; }
.markdown-preview code, .markdown-preview tt { margin: 0px 2px; padding: 0px 5px; border: 1px solid rgb(234, 234, 234); border-radius: 3px; text-shadow: none; background-color: rgb(248, 248, 248); }
.markdown-preview pre.editor-colors { font-size: 13px; line-height: 19px; overflow: auto; padding: 6px 10px; border-radius: 3px; border: 1px solid rgb(224, 224, 225); background: rgb(250, 250, 250); }
.markdown-preview kbd { border-radius: 2px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221) rgb(204, 204, 204) rgb(204, 204, 204) rgb(221, 221, 221); padding: 1px 4px; line-height: 10px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-image: linear-gradient(rgb(241, 241, 241), rgb(221, 221, 221)); background-color: rgb(221, 221, 221); background-repeat: repeat-x; }
.markdown-preview .emoji { height: 20px; width: 20px; }
.markdown-preview { font-size: 1.25em; color: rgb(80, 81, 83); background-color: rgb(255, 255, 255); }
.markdown-preview h1, .markdown-preview h2 { color: inherit; border-color: rgb(218, 219, 220); }
.markdown-preview a { color: rgb(20, 146, 255); }
.markdown-preview hr { background-color: rgb(255, 255, 255); }
.markdown-preview blockquote { color: rgb(80, 81, 83); border-left-color: rgba(80, 81, 83, 0.701961); }
.markdown-preview table th, .markdown-preview table td { border-color: rgb(218, 219, 220); }
.markdown-preview table th { background-color: rgb(255, 255, 255); }
.markdown-preview table tr { background-color: rgb(255, 255, 255); }
.markdown-preview table tr:nth-child(2n) { background-color: rgb(247, 247, 247); }
.markdown-preview code { color: rgb(104, 106, 110); border-color: rgb(218, 219, 220); background-color: rgb(247, 247, 247); background-clip: padding-box; }
.markdown-preview pre.editor-colors::shadow .line.cursor-line { background-color: transparent; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}

.spell-check-misspelling .region {
  border-bottom: 1px dashed rgba(250, 128, 114, 0.5);
}

pre.editor-colors,
.host {
  background-color: #fafafa;
  color: #545454;
}
pre.editor-colors .line.cursor-line,
.host .line.cursor-line {
  background-color: rgba(56, 75, 112, 0.07);
}
pre.editor-colors .invisible,
.host .invisible {
  color: #545454;
}
pre.editor-colors .cursor,
.host .cursor {
  border-left: 2px solid #528bff;
}
pre.editor-colors .selection .region,
.host .selection .region {
  background-color: #e5e5e6;
}
pre.editor-colors .bracket-matcher .region,
.host .bracket-matcher .region {
  border-bottom: 1px solid #528bff;
  box-sizing: border-box;
  background-color: #eaeaeb;
}
pre.editor-colors .invisible-character,
.host .invisible-character {
  color: rgba(84, 84, 84, 0.4);
}
pre.editor-colors .indent-guide,
.host .indent-guide {
  color: rgba(84, 84, 84, 0.4);
}
pre.editor-colors .wrap-guide,
.host .wrap-guide {
  background-color: rgba(84, 84, 84, 0.4);
}
pre.editor-colors .gutter .line-number,
.host .gutter .line-number {
  color: #969696;
  -webkit-font-smoothing: antialiased;
}
pre.editor-colors .gutter .line-number.git-line-removed:before,
.host .gutter .line-number.git-line-removed:before {
  bottom: -3px;
}
pre.editor-colors .gutter .line-number.git-line-removed:after,
.host .gutter .line-number.git-line-removed:after {
  content: "";
  position: absolute;
  left: 0px;
  bottom: 0px;
  width: 25px;
  border-bottom: 1px dotted rgba(255, 20, 20, 0.5);
  pointer-events: none;
}
pre.editor-colors .gutter .line-number.cursor-line,
.host .gutter .line-number.cursor-line {
  color: #545454;
  background-color: #efeff0;
}
pre.editor-colors .gutter .line-number.cursor-line-no-selection,
.host .gutter .line-number.cursor-line-no-selection {
  background-color: transparent;
}
pre.editor-colors .gutter .line-number .icon-right,
.host .gutter .line-number .icon-right {
  color: #545454;
}
pre.editor-colors .gutter .line-number .icon-right,
.host .gutter .line-number .icon-right {
  color: #545454;
}
pre.editor-colors .gutter .line-number.folded,
.host .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
.host .gutter .line-number:after,
pre.editor-colors .fold-marker:after,
.host .fold-marker:after {
  color: #545454;
}
.comment {
  color: #7b7b79;
  font-style: italic;
}
.entity.name.type {
  color: #a58a03;
}
.entity.other.inherited-class {
  color: #428b1c;
}
.keyword {
  color: #a71cce;
}
.keyword.control {
  color: #a71cce;
}
.keyword.operator {
  color: #545454;
}
.keyword.other.special-method {
  color: #1f51eb;
}
.keyword.other.unit {
  color: #893a01;
}
.storage {
  color: #a71cce;
}
.constant {
  color: #893a01;
}
.constant.character.escape {
  color: #0a8560;
}
.constant.numeric {
  color: #893a01;
}
.constant.other.color {
  color: #0a8560;
}
.constant.other.symbol {
  color: #0a8560;
}
.variable {
  color: #bf1212;
}
.variable.interpolation {
  color: #b81332;
}
.variable.parameter.function {
  color: #545454;
}
.invalid.illegal {
  background-color: #bf1212;
  color: #fafafa;
}
.string {
  color: #428b1c;
}
.string.regexp {
  color: #0a8560;
}
.string.other.link {
  color: #bf1212;
}
.punctuation.definition.comment {
  color: #7b7b79;
}
.punctuation.definition.parameters,
.punctuation.definition.array {
  color: #545454;
}
.punctuation.definition.heading,
.punctuation.definition.identity {
  color: #1f51eb;
}
.punctuation.definition.bold {
  color: #a58a03;
  font-weight: bold;
}
.punctuation.definition.italic {
  color: #a71cce;
  font-style: italic;
}
.punctuation.section.embedded {
  color: #b81332;
}
.support.class {
  color: #a58a03;
}
.support.function {
  color: #0a8560;
}
.support.function.any-method {
  color: #1f51eb;
}
.entity.name.function {
  color: #1f51eb;
}
.entity.name.class,
.entity.name.type.class {
  color: #a58a03;
}
.entity.name.section {
  color: #1f51eb;
}
.entity.name.tag {
  color: #bf1212;
}
.entity.other.attribute-name {
  color: #893a01;
}
.entity.other.attribute-name.id {
  color: #1f51eb;
}
.meta.class {
  color: #a58a03;
}
.meta.link {
  color: #893a01;
}
.meta.require {
  color: #1f51eb;
}
.meta.selector {
  color: #a71cce;
}
.meta.separator {
  background-color: #373b41;
  color: #545454;
}
.meta.tag {
  color: #545454;
}
.none {
  color: #545454;
}
.markup.bold {
  color: #893a01;
  font-weight: bold;
}
.markup.changed {
  color: #a71cce;
}
.markup.deleted {
  color: #bf1212;
}
.markup.italic {
  color: #a71cce;
  font-style: italic;
}
.markup.heading .punctuation.definition.heading {
  color: #1f51eb;
}
.markup.inserted {
  color: #428b1c;
}
.markup.list {
  color: #bf1212;
}
.markup.quote {
  color: #893a01;
}
.markup.raw.inline {
  color: #428b1c;
}
.source.gfm .markup {
  -webkit-font-smoothing: auto;
}
.source.gfm .markup.heading {
  color: #bf1212;
}
.source.gfm .markup.link {
  color: #1f51eb;
}
.source.gfm .link .entity {
  color: #0a8560;
}
.ruby.symbol > .punctuation {
  color: inherit;
}
</style>
  </head>
  <body class='markdown-preview'><h1 id="8-advanced-logging">8 Advanced logging</h1>
<p>We are going to be working on the repository that you have created up to this point. If you skipped
ahead, don&#39;t worry. You can clone the repository from its Github repository.</p>
<pre class="editor-colors lang-bash"><div class="line"><span class="source shell"><span>$&nbsp;&nbsp;git&nbsp;clone&nbsp;git@github.com:skafandri/symfony-tutorial.git&nbsp;--branch&nbsp;ch7</span></span></div><div class="line"><span class="source shell"><span>Cloning&nbsp;into&nbsp;</span><span class="string quoted single shell"><span class="punctuation definition string begin shell"><span>&#39;</span></span><span>symfony-tutorial</span><span class="punctuation definition string end shell"><span>&#39;</span></span></span><span>...</span></span></div><div class="line"><span class="source shell"><span>remote:&nbsp;Counting&nbsp;objects:&nbsp;838,&nbsp;</span><span class="keyword control shell"><span>done</span></span><span>.</span></span></div><div class="line"><span class="source shell"><span>remote:&nbsp;Compressing&nbsp;objects:&nbsp;100%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>93/93</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>,&nbsp;</span><span class="keyword control shell"><span>done</span></span><span>.</span></span></div><div class="line"><span class="source shell"><span>remote:&nbsp;Total&nbsp;838&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>delta&nbsp;27</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>,&nbsp;reused&nbsp;0&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>delta&nbsp;0</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>,&nbsp;pack-reused&nbsp;737</span></span></div><div class="line"><span class="source shell"><span>Receiving&nbsp;objects:&nbsp;100%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>838/838</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>,&nbsp;433.96&nbsp;KiB&nbsp;</span><span class="keyword operator pipe shell"><span>|</span></span><span>&nbsp;319.00&nbsp;KiB/s,&nbsp;</span><span class="keyword control shell"><span>done</span></span><span>.</span></span></div><div class="line"><span class="source shell"><span>Resolving&nbsp;deltas:&nbsp;100%&nbsp;</span><span class="meta scope subshell shell"><span class="punctuation definition subshell shell"><span>(</span></span><span>405/405</span><span class="punctuation definition subshell shell"><span>)</span></span></span><span>,&nbsp;</span><span class="keyword control shell"><span>done</span></span><span>.</span></span></div><div class="line"><span class="source shell"><span>Checking&nbsp;connectivity...&nbsp;</span><span class="keyword control shell"><span>done</span></span><span>.</span></span></div></pre>
<p>Don&#39;t forget to <code>composer install</code></p>
<p><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br></p>
<h2 id="8-1-logger-for-json-rpc-bundle">8.1 Logger for JSON-RPC bundle</h2>
<ul>
<li>Edit <strong>src/JsonRpcBundle/Resources/config/services.yml</strong> and add the following service defintition</li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>json_rpc.logger:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;JsonRpcBundle\Logger</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arguments:&nbsp;[&quot;@?logger&quot;]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{&nbsp;name:&nbsp;monolog.logger,&nbsp;channel:&nbsp;json_rpc&nbsp;}</span></span></span></div></pre><ul>
<li>Create <strong>src/JsonRpcBundle/Logger.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bridge</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Monolog</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Logger</span></span><span>&nbsp;</span><span class="keyword other use-as php"><span>as</span></span><span>&nbsp;</span><span class="support other namespace use-as php"><span>LoggerBridge</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>Logger</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ID</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>json_rpc.logger</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>LoggerBridge</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="constant language php"><span>null</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>if</span></span><span>&nbsp;(</span><span class="keyword operator logical php"><span>!</span></span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>LoggerBridge</span></span><span>()</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>logger</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getLogger</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>logger</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br><br><br><br><br><br><br><br><br></p>
<ul>
<li>Update <strong>src/JsonRpcBundle/Controller/ServerController.php</strong> to use the new logger</li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Controller</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Logger</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>JsonRpcBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Server</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>FrameworkBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Controller</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Controller</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>HttpFoundation</span><span class="punctuation separator inheritance php"><span>\</span></span><span>JsonResponse</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>HttpFoundation</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Request</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>ServerController</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>Controller</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>handleAction</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Request</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>service</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>requestContent</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>request</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getContent</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>get</span></span><span>(</span><span class="support class php"><span>Logger</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>ID</span></span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getLogger</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addInfo</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>request</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>content</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>requestContent</span></span><span class="punctuation definition array end php"><span>)</span></span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>server</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>get</span></span><span>(</span><span class="support class php"><span>Server</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>ID</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>server</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>handle</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>requestContent</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>service</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>toArray</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addInfo</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>response</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>JsonResponse</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>result</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br></p>
<p>Now if we try to make a json-rpc call, post to <a href="http://127.0.0.1:8000/json-rpc/warehouse">http://127.0.0.1:8000/json-rpc/warehouse</a></p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>&quot;jsonrpc&quot;:&nbsp;&quot;2.0&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&quot;method&quot;:&nbsp;&quot;getAll&quot;,</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&quot;id&quot;:&nbsp;1</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><p>We can see in <strong>app/logs/dev.log</strong> (or app/logs/prod.log) the following entries</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[]&nbsp;json_rpc.INFO:&nbsp;request&nbsp;{&quot;content&quot;:&quot;{\n&nbsp;&nbsp;\&quot;jsonrpc\&quot;:&nbsp;\&quot;2.0\&quot;,&nbsp;\n&nbsp;&nbsp;\&quot;method\&quot;:\</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>\&quot;getAll\&quot;,&nbsp;\n&nbsp;\&quot;id\&quot;:&nbsp;1\n}&quot;}&nbsp;[]</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[]&nbsp;json_rpc.INFO:&nbsp;response&nbsp;{&quot;id&quot;:1,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:\[{&quot;id&quot;:1,&quot;name&quot;:&quot;w1&quot;,\</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&quot;address&quot;:null},{&quot;id&quot;:2,&quot;name&quot;:&quot;w2&quot;,&quot;address&quot;:null}]}&nbsp;[]</span></span></span></div></pre><p>Note that the logs entries are prepended by <strong>json_rpc</strong> that&#39;s the new channel we created.</p>
<p><br><br><br></p>
<p>Now we want to log entries for this channel to a different file, and stop logging them to the main log file.</p>
<ul>
<li><p>Edit <strong>app/config/config_dev.yml</strong>  </p>
<ul>
<li>Add <code>channels: [&quot;!json_rpc&quot;]</code> to <strong>monolog.handlers.main</strong></li>
<li>And add the following handler to <strong>monolog.handlers</strong><pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>json_rpc:</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>type:&nbsp;&nbsp;&nbsp;stream</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>path:&nbsp;&nbsp;&nbsp;&quot;%kernel.logs_dir%/json-rpc-%kernel.environment%.log&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>level:&nbsp;&nbsp;debug</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>channels:&nbsp;[&quot;json_rpc&quot;]</span></span></span></div></pre></li>
</ul>
</li>
<li><p>Do the same changes to <strong>app/config/config_prod.yml</strong>.</p>
</li>
</ul>
<p>Now you can find the log entries with <strong>json_rpc</strong> channel in <strong>app/logs/json-rpc-dev.log</strong> and <strong>app/logs/json-rpc-prod.log</strong></p>
<p><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br>
<br><br><br><br><br><br><br>
<br><br><br><br><br><br><br></p>
<h2 id="8-2-log-all-events">8.2 Log all events</h2>
<p>Previously, we created the createOrder method in OrderService that triggers two events. And we created OrderListener that performed some tasks, especially logging those events.</p>
<p>However, the order listener logic should perform actions related to the order flow. Moreover, if we will register more than one listener for a specific event, where should we perform the logging? Logically, in none of them.</p>
<p>One option would be to have a Logging listener service that will listen to all events we want to log, and just perform the logging. This option could work if we have few events, but when the event list will grow, it will be hard to maintain the service definition tags list.</p>
<p>To achieve this in a smooth way, we will define a LoggableEventInterface that we will implement in any event we want to be logged. Then we will override the default event dispatcher service with a custom event dispatcher that supports logging.</p>
<ul>
<li>Create <strong>src/AppBundle/Event/LoggableEventInterface.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta interface php"><span class="storage type interface php"><span>interface</span></span><span>&nbsp;</span><span class="entity name type interface php"><span>LoggableEventInterface</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getLogContext</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<ul>
<li>Create <strong>src/AppBundle/Event/EventDispatcher.php</strong></li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;?php</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>namespace&nbsp;AppBundle\Event;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>use&nbsp;Symfony\Component\EventDispatcher\ContainerAwareEventDispatcher;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>use&nbsp;Symfony\Component\EventDispatcher\Event;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>class&nbsp;EventDispatcher&nbsp;extends&nbsp;ContainerAwareEventDispatcher</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>public&nbsp;function&nbsp;dispatch($eventName,&nbsp;Event&nbsp;$event&nbsp;=&nbsp;null)</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>if&nbsp;($event&nbsp;instanceof&nbsp;LoggableEventInterface)&nbsp;{</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>$this-&gt;getContainer()</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&gt;get(&#39;logger&#39;)</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;addInfo($eventName,&nbsp;$event-&gt;getLogContext());</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;parent::dispatch($eventName,&nbsp;$event);</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>}</span></span></span></div></pre><ul>
<li>Edit <strong>src/AppBundle/Resources/config/services.yml</strong> and add the service definition</li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>event_dispatcher:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Event\EventDispatcher</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arguments:&nbsp;[@service_container]</span></span></span></div></pre><p>Our parent servie uses TraceableEventDispatcher, we will update it to make it more independent and uses EventDispatcherInterface</p>
<ul>
<li>Edit <strong>src/AppBundle/Service/AbstractDoctrineAware.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Doctrine</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DoctrineBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Registry</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Doctrine</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ORM</span><span class="punctuation separator inheritance php"><span>\</span></span><span>EntityManager</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Bridge</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Monolog</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Logger</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>EventDispatcher</span><span class="punctuation separator inheritance php"><span>\</span></span><span>EventDispatcherInterface</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>AbstractDoctrineAware</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ID</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>app.doctrine_aware</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block php"><span class="punctuation definition comment php"><span>/*</span></span><span>*&nbsp;@var&nbsp;Registry&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>protected</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>doctrine</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block php"><span class="punctuation definition comment php"><span>/*</span></span><span>*&nbsp;@var&nbsp;EntityManager</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>protected</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>entityManager</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block php"><span class="punctuation definition comment php"><span>/*</span></span><span>*&nbsp;@var&nbsp;Logger&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>protected</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block php"><span class="punctuation definition comment php"><span>/*</span></span><span>*&nbsp;@var&nbsp;EventDispatcherInterface&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>protected</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>eventDispatcher</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>Registry</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>doctrine</span></span></span><span>,</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>Logger</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span></span><span>,</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>EventDispatcherInterface</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>eventDispatcher</span></span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span class="meta function argument typehinted php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>doctrine</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>doctrine</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>doctrine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getManager</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>logger</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>logger</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>eventDispatcher</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br><br><br></p>
<p>Everything should be fine now. Let&#39;s update the events we created previously to implement LoggableEventInterface</p>
<ul>
<li>Edit <strong>src/AppBundle/Event/Order/OrderBeforeCreate.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>LoggableEventInterface</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderBeforeCreate</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>OrderEvent</span></span></span><span>&nbsp;</span><span class="storage modifier implements php"><span>implements</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>LoggableEventInterface</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>customerId</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>products</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getCustomerId</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>customerId</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getProducts</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>products</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getLogContext</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta array php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>customerId</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>customerId</span></span><span>,</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta array php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>products</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>products</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta array php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition array end php"><span>)</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br><br><br><br><br><br><br><br></p>
<ul>
<li>Edit <strong>src/AppBundle/Event/Order/OrderAfterCreate.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>LoggableEventInterface</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderAfterCreate</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>OrderEvent</span></span></span><span>&nbsp;</span><span class="storage modifier implements php"><span>implements</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>LoggableEventInterface</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="keyword other phpdoc php"><span>@var</span></span><span>&nbsp;Order</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>order</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getOrder</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>order</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getLogContext</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>id</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>order</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span class="punctuation definition array end php"><span>)</span></span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>Done, if you try to call the createOrder method, you should see the events logged</p>
<p>app.INFO: order.before_create {&quot;customerId&quot;:&quot;1&quot;,&quot;products&quot;:[{&quot;id&quot;:&quot;1&quot;,&quot;quantity&quot;:&quot;5&quot;},{&quot;id&quot;:&quot;2&quot;,&quot;quantity&quot;:&quot;8&quot;}]} []<br>app.INFO: order.after_create {&quot;id&quot;:54} []</p>
<p>You may notice that we have duplicated logs now<br>app.INFO: order.after_create {&quot;id&quot;:54} []<br>app.INFO: Order created {&quot;orderId&quot;:54} []</p>
<p>We have to update our OrderListener and remove all loggings from it. Also there is no need anymore that it inherits from AbstractDoctrineAware</p>
<p><br><br><br></p>
<ul>
<li>Edit <strong>src/AppBundle/Event/Listener/OrderListener.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Listener</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderAfterCreate</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderBeforeCreate</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span><span class="punctuation separator inheritance php"><span>\</span></span><span>WarehouseService</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderListener</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="keyword other phpdoc php"><span>@var</span></span><span>&nbsp;WarehouseService</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>warehouseService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onBeforeCreate</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderBeforeCreate</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onAfterCreate</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderAfterCreate</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>warehouseService</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>reserveProducts</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>))</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>setWarehouseService</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>WarehouseService</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>warehouseService</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>warehouseService</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>warehouseService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br></p>
<ul>
<li>Edit <strong>src/AppBundle/Resources/config/listeners.yml</strong> and remove <code>parent: app.doctrine_aware</code> from <code>app.order_listener</code>.</li>
</ul>
<p><br></p>
<p>Did you noticed the follwoing entry in the log files?<br>[2015-06-27 13:17:32] php.INFO: The Symfony\Component\Validator\Constraints\True class is deprecated since version 2.7 and will be removed in 3.0. Use the IsTrue class in the same namespace instead.</p>
<p>To fix it, edit <strong>src/AppBundle/Entity/Category.php</strong> and change <code>@Assert\True</code> to <code>@Assert\IsTrue</code> in the <strong>isNotSameAsParent</strong>&#39;s annotation.</p>
<blockquote>
<p>The fix we just did is very important. If you track any warning or deprecation message and fix it, it will take you few minutes effor once every few weeks or few months.<br>You may get some of those warnings every time you upgrade from one minor version to another. However, if you try to update several versions at once (ie: 2.3 to 2.7) you will feel that there is too much to rework and probabaly even withdraw on the upgrade.<br>I recommand upgrading to the latest stable release for many reasons  </p>
<ul>
<li>Your codebase is 6 months older since the last release, and relatively easy to update</li>
<li>Few (sometimes none) updates are needed to ajust your code</li>
<li>Your application potentially gets better performance (depending on how and what you are using from the framework)</li>
</ul>
</blockquote>
<p>As a real example, for a small application (about 15000 lines) I kept upgrading every minor release from 2.3 to 2.7 (at the time of writing this book). I also applied the same strategy to the used bundles (Doctrine, Monolog...). Each upgrade didn&#39;t took more than one hour. I saw teams getting stuck to a LTS (Long Term Support) version which will loose maintainance soon. And upgrading to the next LTS version appears to be a huge refactoring in their application, they are right.</p>
<p>For more details about Symfony release process, visit <a href="https://symfony.com/doc/current/contributing/community/releases.html">https://symfony.com/doc/current/contributing/community/releases.html</a></p>
<p><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br></p>
<h2 id="8-3-extended-order-flow">8.3 Extended Order flow</h2>
<p>We are going to extend the order creation flow as follwoing</p>
<p><br></p>
<p><img src="/home/skafandri/symfony/book/order-flow.png" alt="Order flow"></p>
<p><br><br><br></p>
<p>We are not going to implement all the logic required to execute this flow right now. As usual, we will implement as less as to see the flow working.</p>
<p><br><br><br><br><br><br></p>
<p>As we are going to have a more detailed flow, we will need more detailed order status.</p>
<ul>
<li>Edit <strong>src/AppBundle/Entity/Order.php</strong> and update the status constants block as following</li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span>const&nbsp;STATUS_NEW&nbsp;=&nbsp;1;</span></span></div><div class="line"><span class="text html php"><span>const&nbsp;STATUS_PROCESSING&nbsp;=&nbsp;10;</span></span></div><div class="line"><span class="text html php"><span>const&nbsp;STATUS_PROCESSING_PRODUCTS_MISSING&nbsp;=&nbsp;11;</span></span></div><div class="line"><span class="text html php"><span>const&nbsp;STATUS_PROCESSING_PRODUCTS_RESERVED&nbsp;=&nbsp;14;</span></span></div><div class="line"><span class="text html php"><span>const&nbsp;STATUS_PROCESSING_PACKAGING&nbsp;=&nbsp;15;</span></span></div><div class="line"><span class="text html php"><span>const&nbsp;STATUS_DELIVERY_STARTED&nbsp;=&nbsp;20;</span></span></div><div class="line"><span class="text html php"><span>const&nbsp;STATUS_DELIVERED&nbsp;=&nbsp;29;</span></span></div><div class="line"><span class="text html php"><span>const&nbsp;STATUS_CANCELLED&nbsp;=&nbsp;30;</span></span></div></pre>
<p><br></p>
<ul>
<li>Delete <strong>src/AppBundle/Event/Order/OrderAfterCreate.php</strong> since we will have more detailed order events</li>
</ul>
<p><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br></p>
<ul>
<li>Edit <strong>src/AppBundle/Service/OrderService.php</strong>  </li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Customer</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderProductLine</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ProductSale</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderBeforeCreate</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderEvent</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderService</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>AbstractDoctrineAware</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ID</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>app.order</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>createOrder</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>BEFORE_CREATE</span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderBeforeCreate</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>Order</span></span><span>()</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setCustomer</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>doctrine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getRepository</span></span><span>(</span><span class="support class php"><span>Customer</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>REPOSITORY</span></span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>find</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>customerId</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>foreach</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>products</span></span><span>&nbsp;</span><span class="keyword operator logical php"><span>as</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>product</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>createProductLine</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>product</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>id</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>product</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>quantity</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation section array end php"><span>]</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>persist</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>flush</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>AFTER_CREATE</span></span><span>,</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>flush</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>createProductLine</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productSaleId</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>quantity</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderProductLine</span></span><span>()</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setProductSale</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>doctrine</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getRepository</span></span><span>(</span><span class="support class php"><span>ProductSale</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>REPOSITORY</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>find</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productSaleId</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setQuantity</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>quantity</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setOrder</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addProductLine</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>persist</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>We will refactor OrderBeforeCreate to extend from Event instead of OrderEvent</p>
<ul>
<li>Edit <strong>src/AppBundle/Event/Order/OrderBeforeCreate.php</strong>, update the class header</li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span>namespace&nbsp;AppBundle\Event\Order;</span></span></div><div class="line"><span class="text html php"><span>&nbsp;</span></span></div><div class="line"><span class="text html php"><span>use&nbsp;AppBundle\Event\LoggableEventInterface;</span></span></div><div class="line"><span class="text html php"><span>use&nbsp;Symfony\Component\EventDispatcher\Event;</span></span></div><div class="line"><span class="text html php"><span>&nbsp;</span></span></div><div class="line"><span class="text html php"><span>class&nbsp;OrderBeforeCreate&nbsp;extends&nbsp;Event&nbsp;implements&nbsp;LoggableEventInterface</span></span></div><div class="line"><span class="text html php"><span>{</span></span></div></pre>
<p>We will refactor OrderEvent to implement LoggableEventInterface and add new events constants</p>
<ul>
<li>Edit <strong>src/AppBundle/Event/Order/OrderEvent.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>LoggableEventInterface</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>Symfony</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Component</span><span class="punctuation separator inheritance php"><span>\</span></span><span>EventDispatcher</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>Event</span></span></span><span>&nbsp;</span><span class="storage modifier implements php"><span>implements</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>LoggableEventInterface</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>BEFORE_CREATE</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.before_create</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>AFTER_CREATE</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.after_create</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>PRODUCTS_RESERVATION_FAILED</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.products_reservation_failed</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>PRODUCTS_RESERVED</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.products_reserved</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>PACKAGING_START</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.packaging_start</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>PACKAGING_END</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.packaging_end</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>INVOICE_GENERATED</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.invoice_generated</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>DELIVERY_START</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.delivery_start</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>DELIVERY_END</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>order.delivery_end</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="keyword other phpdoc php"><span>@var</span></span><span>&nbsp;Order</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>order</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getOrder</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>order</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getLogContext</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>id</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>order</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span class="punctuation definition array end php"><span>)</span></span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>Let&#39;s add the new events to our events parameters list  </p>
<ul>
<li>Edit <strong>src/AppBundle/Resources/config/events.xml</strong> add the following arguments</li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;parameter&nbsp;key=&quot;app.order_reservation_failed&quot;&nbsp;type=&quot;constant&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&gt;AppBundle\Event\Order\OrderEvent::PRODUCTS_RESERVATION_FAILED&lt;/parameter&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;parameter&nbsp;key=&quot;app.order_products_reserved&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>type=&quot;constant&quot;&gt;AppBundle\Event\Order\OrderEvent::PRODUCTS_RESERVED&lt;/parameter&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;parameter&nbsp;key=&quot;app.order_packaging_start&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>type=&quot;constant&quot;&gt;AppBundle\Event\Order\OrderEvent::PACKAGING_START&lt;/parameter&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;parameter&nbsp;key=&quot;app.order_packaging_end&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>type=&quot;constant&quot;&gt;AppBundle\Event\Order\OrderEvent::PACKAGING_END&lt;/parameter&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;parameter&nbsp;key=&quot;app.order_invoice_generated&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>type=&quot;constant&quot;&gt;AppBundle\Event\Order\OrderEvent::INVOICE_GENERATED&lt;/parameter&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;parameter&nbsp;key=&quot;app.order_delivery_start&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>type=&quot;constant&quot;&gt;AppBundle\Event\Order\OrderEvent::DELIVERY_START&lt;/parameter&gt;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&lt;parameter&nbsp;key=&quot;app.order_delivery_end&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>type=&quot;constant&quot;&gt;AppBundle\Event\Order\OrderEvent::DELIVERY_END&lt;/parameter&gt;</span></span></span></div></pre><p>We will create a communication service that will handle communication (human, not technical) with the exterior world.</p>
<ul>
<li>Create <strong>src/AppBundle/Service/Communication/CommunicationService.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Communication</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>CommunicationService</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ID</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>app.communication</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>EmailService</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailService</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>emailService</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>sendConfirmationEmail</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>orderNumber</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>sendDeliveryEmail</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>orderNumber</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>sendInvoice</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>orderNumber</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>sendSatisfactionSurvey</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span></span><span>,</span><span class="meta function argument no-default php"><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>orderNumber</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<ul>
<li>Move <strong>src/AppBundle/Service/EmailService.php</strong> to <strong>src/AppBundle/Service/Communication/EmailService.php</strong> and change the namespace to <code>AppBundle\Service\Communication</code></li>
</ul>
<p>We need a delivery service that will handle delivery related logic.</p>
<ul>
<li>Create <strong>src/AppBundle/Service/DeliveryService.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderEvent</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>DeliveryService</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>AbstractDoctrineAware</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ID</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>app.delivery</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>deliverProducts</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>DELIVERY_START</span></span><span>,&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>DELIVERY_END</span></span><span>,&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>To generate an invoice, we will create a document service that will be responsible of several documents management in the future.</p>
<ul>
<li>Create <strong>src/AppBundle/Service/DocumentService.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderEvent</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>DocumentService</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>AbstractDoctrineAware</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ID</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>app.document</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>generateInvoice</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>INVOICE_GENERATED</span></span><span>,&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p>We will update OrderListener to handle the new events</p>
<ul>
<li>Edit <strong>src/AppBundle/Event/Listener/OrderListener.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Listener</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderBeforeCreate</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderEvent</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span><span class="punctuation separator inheritance php"><span>\</span></span><span>DeliveryService</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span><span class="punctuation separator inheritance php"><span>\</span></span><span>WarehouseService</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderListener</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="keyword other phpdoc php"><span>@var</span></span><span>&nbsp;WarehouseService</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>warehouseService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block documentation phpdoc php"><span class="punctuation definition comment php"><span>/**</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="keyword other phpdoc php"><span>@var</span></span><span>&nbsp;DeliveryService</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="comment block documentation phpdoc php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>deliveryService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>WarehouseService</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>warehouseService</span></span></span><span>,</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function argument typehinted php"><span class="support class php"><span>DeliveryService</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>deliveryService</span></span><span>&nbsp;</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span class="meta function arguments php"><span class="meta function argument typehinted php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>warehouseService</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>warehouseService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>deliveryService</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>deliveryService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onBeforeCreate</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderBeforeCreate</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onAfterCreate</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>warehouseService</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>reserveProducts</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>))</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onReservationFailed</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setStatus</span></span><span>(</span><span class="support class php"><span>Order</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>STATUS_PROCESSING_PRODUCTS_MISSING</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onProductsReserved</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setStatus</span></span><span>(</span><span class="support class php"><span>Order</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>STATUS_PROCESSING_PRODUCTS_RESERVED</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>warehouseService</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>packageProducts</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>))</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onPackagingStart</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setStatus</span></span><span>(</span><span class="support class php"><span>Order</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>STATUS_PROCESSING_PACKAGING</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onPackagingEnd</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>deliveryService</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>deliverProducts</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>))</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onDeliveryStart</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setStatus</span></span><span>(</span><span class="support class php"><span>Order</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>STATUS_DELIVERY_STARTED</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onDeliveryEnd</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setStatus</span></span><span>(</span><span class="support class php"><span>Order</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>STATUS_DELIVERED</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br></p>
<ul>
<li>Edit <strong>src/AppBundle/Resources/config/services.yml</strong> to add the new service definitions</li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>imports:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{&nbsp;resource:&nbsp;listeners.yml&nbsp;}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;{&nbsp;resource:&nbsp;events.xml&nbsp;}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;{&nbsp;resource:&nbsp;email_providers.yml&nbsp;}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>services:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.doctrine_aware:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\AbstractDoctrineAware</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arguments:&nbsp;[@doctrine,&nbsp;@logger,&nbsp;@event_dispatcher]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abstract:&nbsp;true</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.warehouse:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\WarehouseService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent:&nbsp;app.doctrine_aware</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;json_rpc.service,&nbsp;method:&nbsp;getAll}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.catalog:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\CatalogService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent:&nbsp;app.doctrine_aware</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.order:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\OrderService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent:&nbsp;app.doctrine_aware</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;json_rpc.service,&nbsp;method:&nbsp;createOrder}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>order:&nbsp;@app.order</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;warehouse:&nbsp;@app.warehouse</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;app.email:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\Communication\EmailService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public:&nbsp;false</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calls:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;[&quot;addProvider&quot;,&nbsp;[&quot;@=service(&#39;kernel&#39;).getEnvironment()&nbsp;===&nbsp;&#39;dev&#39;&nbsp;?</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;service(&#39;app.provider_email_dev&#39;)&nbsp;:&nbsp;service(&#39;app.provider_email_php&#39;)&quot;]]</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.communication:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\Communication\CommunicationService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arguments:&nbsp;[@app.email]</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>event_dispatcher:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Event\EventDispatcher</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arguments:&nbsp;[@service_container]</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.document:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\DocumentService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent:&nbsp;app.doctrine_aware</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.delivery:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Service\DeliveryService</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent:&nbsp;app.doctrine_aware</span></span></span></div></pre><p><br><br><br><br><br><br></p>
<ul>
<li>Edit <strong>src/AppBundle/Resources/config/listeners.yml</strong> to add new tags with the new events</li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>services:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.listener.soft_delete:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Event\Listener\SoftDelete</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{&nbsp;name:&nbsp;doctrine.event_listener,&nbsp;event:&nbsp;onFlush&nbsp;}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.order_listener:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Event\Listener\OrderListener</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arguments:&nbsp;[@app.warehouse,&nbsp;@app.delivery]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags:&nbsp;#Put&nbsp;every&nbsp;tag&nbsp;on&nbsp;single&nbsp;line,&nbsp;I&nbsp;split&nbsp;them&nbsp;here&nbsp;for&nbsp;readability</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_before_create%,method:onBeforeCreate}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_after_create%,method:onAfterCreate}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_reservation_failed%,method:onReservationFailed}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_products_reserved%,method:onProductsReserved}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_packaging_start%,method:onPackagingStart}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_packaging_end%,method:onPackagingEnd}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_delivery_start%,method:onDeliveryStart}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_delivery_end%,method:onDeliveryEnd}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>app.communication_listener:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>class:&nbsp;AppBundle\Event\Listener\OrderCommunicationListener</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arguments:&nbsp;[@app.communication]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tags:&nbsp;#Put&nbsp;every&nbsp;tag&nbsp;on&nbsp;single&nbsp;line,&nbsp;I&nbsp;split&nbsp;them&nbsp;here&nbsp;for&nbsp;readability</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_after_create%,method:onAfterCreate}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_invoice_generated%,method:onInvoiceGenerated}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_delivery_start%,method:onDeliveryStart}</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>-&nbsp;{name:&nbsp;kernel.event_listener,event:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>%app.order_delivery_end%,method:onDeliveryEnd}</span></span></span></div></pre><p><br><br><br><br><br><br><br><br></p>
<ul>
<li>Edit <strong>src/AppBundle/Service/WarehouseService.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>ProductStock</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Entity</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Warehouse</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderEvent</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>WarehouseService</span></span><span>&nbsp;</span><span class="storage modifier extends php"><span>extends</span></span><span>&nbsp;</span><span class="meta other inherited-class php"><span class="entity other inherited-class php"><span>AbstractDoctrineAware</span></span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>const</span></span><span>&nbsp;</span><span class="constant other php"><span>ID</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>app.warehouse</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getAll</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>createQueryBuilder</span></span><span>(</span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>select</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>warehouse</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>from</span></span><span>(</span><span class="support class php"><span>Warehouse</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>REPOSITORY</span></span><span>,&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>warehouse</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getQuery</span></span><span>(</span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getArrayResult</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getProductStocks</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument no-default php"><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productId</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>stocks</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span><span class="keyword operator class php"><span>-&gt;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call php"><span>getRepository</span></span><span>(</span><span class="support class php"><span>ProductStock</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>REPOSITORY</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>findBy</span></span><span>(</span><span class="meta array php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>product</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator key php"><span>=&gt;</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productId</span></span><span class="punctuation definition array end php"><span>)</span></span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>if</span></span><span>&nbsp;(</span><span class="support function construct php"><span>empty</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>stocks</span></span><span>))&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>logger</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>addNotice</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support function string php"><span>sprintf</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>No&nbsp;stocks&nbsp;found&nbsp;for&nbsp;product&nbsp;%s</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productId</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>stocks</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>reserveProducts</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>if</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>checkProductsStock</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>))&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>doReserveProducts</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>PRODUCTS_RESERVED</span></span><span>,&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span><span>&nbsp;</span><span class="keyword control php"><span>else</span></span><span>&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>PRODUCTS_RESERVATION_FAILED</span></span><span>,&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>doReserveProducts</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>checkProductsStock</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>quantities</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="meta array empty php"><span class="support function construct php"><span>array</span></span><span class="punctuation definition array begin php"><span>(</span></span><span class="punctuation definition array end php"><span>)</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>foreach</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getProductLines</span></span><span>(</span><span>)&nbsp;</span><span class="keyword operator logical php"><span>as</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getProductSale</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getProduct</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>quantities</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span class="punctuation section array end php"><span>]</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productLine</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getQuantity</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productStocks</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getProductStocksByProductIds</span></span><span>(</span><span class="support function array php"><span>array_keys</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>quantities</span></span><span>))</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>execute</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>foreach</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productStocks</span></span><span>&nbsp;</span><span class="keyword operator logical php"><span>as</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productStock</span></span><span>)&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productStock</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getProduct</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>if</span></span><span>&nbsp;(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>quantities</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span class="punctuation section array end php"><span>]</span></span><span>&nbsp;</span><span class="keyword operator comparison php"><span>&lt;=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productStock</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getQuantity</span></span><span>(</span><span>))&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support function construct php"><span>unset</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>quantities</span></span><span class="punctuation section array begin php"><span>[</span></span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>id</span></span><span class="punctuation section array end php"><span>]</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="support function construct php"><span>empty</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>quantities</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getProductStocksByProductIds</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument array php"><span class="storage type php"><span>array</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productIds</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>entityManager</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>createQueryBuilder</span></span><span>(</span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>select</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>productStock</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>from</span></span><span>(</span><span class="support class php"><span>ProductStock</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>REPOSITORY</span></span><span>,&nbsp;</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>productStock</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>where</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>productStock.product&nbsp;in&nbsp;(:products)</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>setParameter</span></span><span>(</span><span class="string quoted single php"><span class="punctuation definition string begin php"><span>&#39;</span></span><span class="meta string-contents quoted single php"><span>products</span></span><span class="punctuation definition string end php"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>productIds</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getQuery</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>packageProducts</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>Order</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>PACKAGING_START</span></span><span>,&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>eventDispatcher</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>dispatch</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span class="keyword operator class php"><span>::</span></span><span class="constant other class php"><span>PACKAGING_END</span></span><span>,&nbsp;</span><span class="keyword other new php"><span>new</span></span><span>&nbsp;</span><span class="support class php"><span>OrderEvent</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>order</span></span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br><br><br><br><br></p>
<ul>
<li>Create <strong>src/AppBundle/Event/Listener/OrderCommunicationListener.php</strong></li>
</ul>
<pre class="editor-colors lang-php"><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="punctuation section embedded begin php"><span>&lt;?php</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta namespace php"><span class="keyword other namespace php"><span>namespace</span></span><span>&nbsp;</span><span class="entity name type namespace php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Listener</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Event</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Order</span><span class="punctuation separator inheritance php"><span>\</span></span><span>OrderEvent</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta use php"><span class="keyword other use php"><span>use</span></span><span>&nbsp;</span><span class="support other namespace use php"><span>AppBundle</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Service</span><span class="punctuation separator inheritance php"><span>\</span></span><span>Communication</span><span class="punctuation separator inheritance php"><span>\</span></span><span>CommunicationService</span></span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta class php"><span class="storage type class php"><span>class</span></span><span>&nbsp;</span><span class="entity name type class php"><span>OrderCommunicationListener</span></span><span>&nbsp;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment block php"><span class="punctuation definition comment php"><span>/*</span></span><span>*&nbsp;@var&nbsp;CommunicationService&nbsp;</span><span class="punctuation definition comment php"><span>*/</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>communicationService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="support function magic php"><span>__construct</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>CommunicationService</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>communicationService</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>communicationService</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>communicationService</span></span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onAfterCreate</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getEmailAddress</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>communicationService</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>sendConfirmationEmail</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onInvoiceGenerated</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getEmailAddress</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>communicationService</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>sendDeliveryEmail</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onDeliveryStart</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getEmailAddress</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>communicationService</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>sendDeliveryEmail</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>public</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>onDeliveryEnd</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span><span>&nbsp;</span><span class="keyword operator assignment php"><span>=</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getEmailAddress</span></span><span>(</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>this</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="variable other property php"><span>communicationService</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>sendSatisfactionSurvey</span></span><span>(</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>emailAddress</span></span><span>,&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getId</span></span><span>(</span><span>)</span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="meta function php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier php"><span>private</span></span><span>&nbsp;</span><span class="storage type function php"><span>function</span></span><span>&nbsp;</span><span class="entity name function php"><span>getEmailAddress</span></span><span class="punctuation definition parameters begin php"><span>(</span></span><span class="meta function arguments php"><span class="meta function argument typehinted php"><span class="support class php"><span>OrderEvent</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span></span></span><span class="punctuation definition parameters end php"><span>)</span></span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin php"><span>{</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control php"><span>return</span></span><span>&nbsp;</span><span class="variable other php"><span class="punctuation definition variable php"><span>$</span></span><span>event</span></span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getOrder</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getCustomer</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getContact</span></span><span>(</span><span>)</span><span class="keyword operator class php"><span>-&gt;</span></span><span class="meta function-call object php"><span>getEmail</span></span><span>(</span><span>)</span><span class="punctuation terminator expression php"><span>;</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div><div class="line"><span class="text html php"><span class="meta embedded block php"><span class="source php"><span class="punctuation section scope end php"><span>}</span></span></span></span></span></div></pre>
<p><br></p>
<p>Perfect, if you try to call the createOrder method with valid product sale id and quantity, you will see the following logs</p>
<p>app.INFO: order.before_create {&quot;customerId&quot;:&quot;1&quot;,&quot;products&quot;:[{&quot;id&quot;:&quot;3&quot;,&quot;quantity&quot;:&quot;5&quot;}]} []<br>app.INFO: order.after_create {&quot;id&quot;:84} []<br>app.INFO: order.products_reserved {&quot;id&quot;:84} []<br>app.INFO: order.packaging_start {&quot;id&quot;:84} []<br>app.INFO: order.packaging_end {&quot;id&quot;:84} []<br>app.INFO: order.delivery_start {&quot;id&quot;:84} []<br>app.INFO: order.delivery_end {&quot;id&quot;:84} []  </p>
<p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></p>
<h2 id="8-4-view-logs-in-kibana">8.4 View logs in Kibana</h2>
<p>Logging is not just a matter of writing history events to files. With a proper logging setup, we can have a near realtime view on the application behaviour while running on production.</p>
<p>We will install the following setup: update the application to log to an elasticsearch server, setup and run elasticsearch server, install kibana and connect it to the elasticsearch instance.</p>
<p>The following instructions is the minimum required for a working development environment. For more details about installation options and configurations, please visit the online documentation<br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</a><br><a href="https://www.elastic.co/guide/en/kibana/current/index.html">https://www.elastic.co/guide/en/kibana/current/index.html</a></p>
<p>For more download options, please visit <a href="https://www.elastic.co/downloads/elasticsearch">https://www.elastic.co/downloads/elasticsearch</a></p>
<p>Install elasticsearch</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>$&nbsp;curl&nbsp;-L&nbsp;-O&nbsp;\</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span class="markup underline link https hyperlink"><span>https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.6.0.tar.gz</span></span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>%&nbsp;Total&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;Received&nbsp;%&nbsp;Xferd&nbsp;&nbsp;Average&nbsp;Speed&nbsp;&nbsp;&nbsp;Time&nbsp;&nbsp;&nbsp;&nbsp;Time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time&nbsp;&nbsp;Current</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>Dload&nbsp;&nbsp;Upload&nbsp;&nbsp;&nbsp;Total&nbsp;&nbsp;&nbsp;Spent&nbsp;&nbsp;&nbsp;&nbsp;Left&nbsp;&nbsp;Speed</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>100&nbsp;27.0M&nbsp;&nbsp;100&nbsp;27.0M&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;2294k&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;0:00:12&nbsp;&nbsp;0:00:12&nbsp;--:--:--&nbsp;4431k</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>$&nbsp;tar&nbsp;-xvf&nbsp;elasticsearch-1.6.0.tar.gz</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>$&nbsp;cd&nbsp;elasticsearch-1.6.0/bin/</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>$&nbsp;./elasticsearch&nbsp;--node.name&nbsp;logs</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][node&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;version[1.6.0],&nbsp;pid[30511],&nbsp;build...</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][node&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;initializing&nbsp;...</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][plugins&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;loaded&nbsp;[],&nbsp;sites&nbsp;[]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][env&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;using&nbsp;[1]&nbsp;data&nbsp;paths,&nbsp;mounts&nbsp;[[/&nbsp;...</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][node&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;initialized</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][node&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;starting&nbsp;...</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][transport&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;bound_address&nbsp;&nbsp;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{inet[/0:0:0:0:0:0:0:0:9300]},&nbsp;publish_address&nbsp;{inet[/192.168.1.143:9300]}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][discovery&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;elasticsearch/1KtA1thHTGCfh9v7wts6vQ</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][cluster.service&nbsp;]&nbsp;[logs]&nbsp;new_master&nbsp;[logs][1KtA1thHTGCfh9v7wts6vQ]</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>[asus][inet[/192.168.1.143:9300]],&nbsp;reason:&nbsp;zen-disco-join&nbsp;(elected_as_master)</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][http&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;bound_address&nbsp;&nbsp;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{inet[/0:0:0:0:0:0:0:0:9200]},&nbsp;publish_address&nbsp;{inet[/192.168.1.143:9200]}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][node&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;started</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][gateway&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;[logs]&nbsp;recovered&nbsp;[0]&nbsp;indices&nbsp;into&nbsp;cluster_state</span></span></span></div></pre><p>The server is up and running. Leave it running and let&#39;s update our application to send the logs to this instance.</p>
<p><br></p>
<p>Next, we need to install <strong>ruflin/elastica</strong> bundle, it provides an elasticsearch client.</p>
<p>Add <code>ruflin/elastica</code> to composer.json and run <code>composer update</code></p>
<ul>
<li>Edit <strong>app/config/config_dev.yml</strong> and <strong>app/config/config_prod.yml</strong> add the following handler to both of them, under <strong>monolog.handlers</strong></li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>elasticsearch:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>type:&nbsp;&nbsp;&nbsp;elasticsearch</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;elasticsearch:</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>host:&nbsp;localhost</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>level:&nbsp;info</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;&nbsp;&nbsp;channels:&nbsp;[app,&nbsp;json_rpc]</span></span></span></div></pre><p>Now try to run any action that produces logs and watch the elasticsearch console output</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][cluster.metadata]&nbsp;[logs]&nbsp;[monolog]&nbsp;creating&nbsp;index,</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>cause&nbsp;[auto(bulk&nbsp;api)],&nbsp;templates&nbsp;[],&nbsp;shards&nbsp;[5]/[1],&nbsp;mappings&nbsp;[logs]</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][cluster.metadata]&nbsp;[logs]&nbsp;[monolog]&nbsp;update_mapping&nbsp;[logs]&nbsp;(dynamic)</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][cluster.metadata]&nbsp;[logs]&nbsp;[monolog]&nbsp;update_mapping&nbsp;[logs]&nbsp;(dynamic)</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>[datetime][INFO&nbsp;][cluster.metadata]&nbsp;[logs]&nbsp;[monolog]&nbsp;update_mapping&nbsp;[logs]&nbsp;(dynamic)</span></span></span></div></pre><p>Done, now our application is sending logs to the elasticsearch instance, we need to install kibana to view the logs.<br>For more download options, please visit <a href="https://www.elastic.co/downloads/kibana">https://www.elastic.co/downloads/kibana</a></p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>$&nbsp;curl&nbsp;-L&nbsp;-O&nbsp;</span><span class="markup underline link https hyperlink"><span>https://download.elastic.co/kibana/kibana/kibana-4.1.0-linux-x64.tar.gz</span></span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span><span class="meta paragraph text"><span>%&nbsp;Total&nbsp;&nbsp;&nbsp;&nbsp;%&nbsp;Received&nbsp;%&nbsp;Xferd&nbsp;&nbsp;Average&nbsp;Speed&nbsp;&nbsp;&nbsp;Time&nbsp;&nbsp;&nbsp;&nbsp;Time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time&nbsp;&nbsp;Current</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta paragraph text"><span>Dload&nbsp;&nbsp;Upload&nbsp;&nbsp;&nbsp;Total&nbsp;&nbsp;&nbsp;Spent&nbsp;&nbsp;&nbsp;&nbsp;Left&nbsp;&nbsp;Speed</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>100&nbsp;10.1M&nbsp;&nbsp;100&nbsp;10.1M&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;1181k&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;0:00:08&nbsp;&nbsp;0:00:08&nbsp;--:--:--&nbsp;2001k</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>$&nbsp;tar&nbsp;-xvf&nbsp;kibana-4.1.0-linux-x64.tar.gz</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>$&nbsp;cd&nbsp;kibana-4.1.0-linux-x64/bin/</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>$&nbsp;$&nbsp;./kibana</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{&quot;name&quot;:&quot;Kibana&quot;,&quot;hostname&quot;:&quot;asus&quot;,&quot;pid&quot;:31331,&quot;level&quot;:30,&quot;msg&quot;:&nbsp;&nbsp;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&quot;No&nbsp;existing&nbsp;kibana&nbsp;index&nbsp;found&quot;,&quot;time&quot;:&quot;2015-06-28T19:31:45.416Z&quot;,&quot;v&quot;:0}</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>{&quot;name&quot;:&quot;Kibana&quot;,&quot;hostname&quot;:&quot;asus&quot;,&quot;pid&quot;:31331,&quot;level&quot;:30,&quot;msg&quot;:&quot;Listening&nbsp;on&nbsp;&nbsp;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>0.0.0.0:5601&quot;,&quot;time&quot;:&quot;2015-06-28T19:31:45.436Z&quot;,&quot;v&quot;:0}</span></span></span></div></pre><p>Done, visit <a href="http://127.0.0.1:5601/">http://127.0.0.1:5601/</a> and enter <strong>monolog</strong> in the index pattern, click create. Everything is up and running, click on Discover to see the logs.</p>
<p><br><br></p>
<h2 id="8-4-homework">8.4 Homework</h2>
<ol>
<li>Every time the order status changes, log the change (old status, new status).</li>
<li>Update the order.products_reserved event to log the list of reserved products IDs and their quantities.</li>
</ol></body>
</html>
